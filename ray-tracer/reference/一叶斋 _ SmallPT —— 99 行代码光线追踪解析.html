<!DOCTYPE html>
<!-- saved from url=(0070)https://xieguanglei.github.io/blog/post/ray-tracing-99-lines-code.html -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(){function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}hookGeo();})()</script>
    <meta content="text/html">
    
    <meta name="author" content="谢光磊">
    <meta name="keywords" content="一叶斋,谢光磊,,TypeScript,编程随想,D2,2020 D2,,assert,,,,,光线追踪,SmallPT">
    <title>一叶斋 | SmallPT —— 99 行代码光线追踪解析</title>
    <link href="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/index.css" rel="stylesheet">
    <style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head><body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div><div id="ga_id" style="display: none">UA-73144174-1</div>
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', document.getElementById('ga_id').innerText, 'auto');
      ga('send', 'pageview');
    </script>
    <script src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/analytics.js" async=""></script>
  
  
    <div id="header">
      <h1 id="title"><a href="https://xieguanglei.github.io/">一叶斋</a></h1>
      <div class="links"><a href="http://xieguanglei.github.io/blog/feed.xml" target="_blank">
          <div class="iconfont icon-rss"></div></a><a href="http://github.com/xieguanglei" target="_blank">
          <div class="iconfont icon-github"></div></a><a href="https://xieguanglei.github.io/blog/post/about.html" target="_blank">
          <div class="iconfont icon-author"></div></a>
      </div>
    </div>
    <div id="main">
      <div id="post">
        <div class="main">
          <h3 class="date">2019/06/22</h3>
          <div><h1 id="smallpt--99-行代码光线追踪解析">SmallPT —— 99 行代码光线追踪解析</h1>
<p>光线追踪（Ray tracing）是三维计算机图形学中的特殊渲染算法：根据光路可逆原理，对每一个像素，沿着入射光线逆向追踪若干次反射、折射，进而计算此光线的颜色，把场景渲染出来。</p>
<p>理论上，光线追踪算法可以完整地模拟物理世界中的光照，分毫不差地计算出每个像素的颜色，但是这样做的算力消耗趋近于正无穷。所以实际上所有光线追踪算法都包含了一些近似优化的逻辑，以将运算开销控制在可接受的数量级内。</p>
<p><a href="http://rhythm.com/">Rhythm &amp; Hues Studios</a> 公司的程序员 <a href="http://kevinbeason.com/">Kevin Beason</a> 曾于 2010 年编写过一个名为 SmallPT 的 C++ <a href="http://www.kevinbeason.com/smallpt/">程序</a>，仅包含 99 行<a href="https://github.com/munificent/smallpt/blob/master/smallpt.cpp">代码</a>，即实现了最简单的光线追踪效果。此程序可视为光追算法的可运行最小集，是初学者学习和理解光追原理的极佳材料，其运行结果如下图所示。作为一个门外汉，我花了好几个晚上研究这 99 行代码，并在这个极好的 <a href="https://drive.google.com/file/d/0B8g97JkuSSBwUENiWTJXeGtTOHFmSm51UC01YWtCZw/view">PPT</a> 的帮助下，总算基本弄明白了其运行的原理。不妨记录下来：</p>
<p></p><figure><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1Hex0dqWs3KVjSZFxXXaWUXXa-640-480.jpg" alt="Small PT 程序运行结果"><figurecaption>Small PT 程序运行结果</figurecaption></figure><p></p>
<h2 id="渲染方程">渲染方程</h2>
<p>还是从最基础的渲染方程开始：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A9;&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 22.82em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 18.108em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.945em, 1018.06em, 3.574em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="msubsup" id="MathJax-Span-3"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-4" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-5" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑜</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-6" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral-Italic;">𝑜</span><span class="mo" id="MathJax-Span-8" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-9" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-10" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-11" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-12" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑒</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-13" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-14" style="font-family: STIXGeneral-Italic;">𝑜</span><span class="mo" id="MathJax-Span-15" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-16" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-17" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(2.483em, 1001.04em, 5.062em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-18" style="font-family: STIXIntegralsD; vertical-align: -0.593em;">∫<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.449em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.073em; left: 0.598em;"><span class="mi" id="MathJax-Span-19" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">Ω</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-20" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-21" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-22" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-23" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-24" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-25" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-26" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-27" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝐹<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-28" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑜</span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-33" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-34" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">cos</span><span class="mo" id="MathJax-Span-35"></span><span class="mi" id="MathJax-Span-36" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝜃</span><span class="mo" id="MathJax-Span-37" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑑</span><span class="mi" id="MathJax-Span-39" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.247em; border-left: 0px solid; width: 0px; height: 3.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>o</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>L</mi><mi>e</mi></msub><mo stretchy="false">(</mo><mi>o</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mo>∫</mo><mi mathvariant="normal">Ω</mi></msub><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>F</mi><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>o</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>⋅</mo><mi>d</mi><mi>i</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\begin{equation}L_o(o)=L_e(o)+\int_\Omega L_i(i)\cdot F(i, o)\cdot \cos\theta\cdot di \end{equation}</script></p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB19602dEKF3KVjSZFEXXXExFXa-504-189.png" alt=""></p>
<p>解释：</p>
<ol>
<li>此方程描述的问题是：从物体表面上的一点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-40" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-41"><span class="mi" id="MathJax-Span-42" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">P</script> 处，射入到观察者眼中的某条光线的强度，是如何确定的。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-43" style="width: 2.83em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.235em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.18em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-44"><span class="msubsup" id="MathJax-Span-45"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-46" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-47" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑜</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-48" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-49" style="font-family: STIXGeneral-Italic;">𝑜</span><span class="mo" id="MathJax-Span-50" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>o</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">L_o(o)</script> 为射入观察者眼中的光线的颜色，即需要求取的值；<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-51" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-52"><span class="mi" id="MathJax-Span-53" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">o</script> 为出射方向。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-54" style="width: 2.83em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.235em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.18em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-55"><span class="msubsup" id="MathJax-Span-56"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-57" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-58" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑒</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-59" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-60" style="font-family: STIXGeneral-Italic;">𝑜</span><span class="mo" id="MathJax-Span-61" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>e</mi></msub><mo stretchy="false">(</mo><mi>o</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">L_e(o)</script> 为物体表面在点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-62" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">P</script> 向观察者方向自发射的光线的颜色（灯）。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-65" style="width: 2.532em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.987em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.94em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-66"><span class="msubsup" id="MathJax-Span-67"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-68" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-69" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-70" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-71" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-72" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">L_i(i)</script> 表示环境入射到点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-73" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-74"><span class="mi" id="MathJax-Span-75" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">P</script> 的光的颜色；<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-76" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-77"><span class="mi" id="MathJax-Span-78" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">i</script> <strong>代表</strong>入射方向（为计算方便，取真实入射方向的反方向，不影响<strong>代表</strong>关系，后面也简称为入射方向）。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-79" style="width: 3.326em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.58em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-80"><span class="mi" id="MathJax-Span-81" style="font-family: STIXGeneral-Italic;">𝐹<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-82" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-83" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-84" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-85" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑜</span><span class="mo" id="MathJax-Span-86" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>o</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-10">F(i,o)</script> 表示在给定 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-87" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-88"><span class="mi" id="MathJax-Span-89" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">i</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-90" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-91"><span class="mi" id="MathJax-Span-92" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">o</script> 时，由 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-93" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">i</script> 方向的入射单位光强产生的 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-96" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">o</script> 方向的出射光的强度，此函数与表面的性质有关，又称表面的 BRDF 函数。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-99" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-family: STIXGeneral-Italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">\theta</script> 表示 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-102" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">i</script> 与表面法线的夹角。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A9;&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-105" style="width: 13.941em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.064em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em, 1011.01em, 2.979em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-106"><span class="msubsup" id="MathJax-Span-107"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.028em, 1000.65em, 4.467em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-108" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∫<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.668em; left: 0.449em;"><span class="mi" id="MathJax-Span-109" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">Ω</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-110" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral-Italic;">𝐿</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-112" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-113" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-114" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-115" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-116" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-117" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝐹<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-118" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-119" style="font-family: STIXGeneral-Italic;">𝑖</span><span class="mo" id="MathJax-Span-120" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-121" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑜</span><span class="mo" id="MathJax-Span-122" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-123" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-124" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">cos</span><span class="mo" id="MathJax-Span-125"></span><span class="mi" id="MathJax-Span-126" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝜃</span><span class="mo" id="MathJax-Span-127" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-128" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑑</span><span class="mi" id="MathJax-Span-129" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mo>∫</mo><mi mathvariant="normal">Ω</mi></msub><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>F</mi><mo stretchy="false">(</mo><mi>i</mi><mo>,</mo><mi>o</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>⋅</mo><mi>d</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">\int_\Omega L_i(i)\cdot F(i, o)\cdot \cos\theta\cdot di</script> 整个积分项表示：对半球（不透明材质）或全球（透明介质）内的所有入射方向 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-130" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-131"><span class="mi" id="MathJax-Span-132" style="font-family: STIXGeneral-Italic;">𝑖</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">i</script> 进行积分，得到的 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-133" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-134"><span class="mi" id="MathJax-Span-135" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">o</script> 方向的出射光强度。</li>
</ol>
<p>依照光线追踪的原理，我们沿着 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-136" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-137"><span class="mi" id="MathJax-Span-138" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">o</script> 方向追踪到一处交点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-139" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-140"><span class="mi" id="MathJax-Span-141" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">P</script>，就需要进行一次积分操作。在计算机程序中，积分是用求和模拟的，求和的次数越多（自变量的间隔越小），结果就越准确。假设每次积分都要进行 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-142" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-143"><span class="mi" id="MathJax-Span-144" style="font-family: STIXGeneral-Italic;">𝑛</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-22">n</script> 次求和操作，那么当追踪的光线遇到第一个交点时，会发散成 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-145" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-146"><span class="mi" id="MathJax-Span-147" style="font-family: STIXGeneral-Italic;">𝑛</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">n</script> 条光线；同时追踪这 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-148" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-149"><span class="mi" id="MathJax-Span-150" style="font-family: STIXGeneral-Italic;">𝑛</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">n</script> 条光线，到下一个交点，每条光线又会发散成 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-151" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-152"><span class="mi" id="MathJax-Span-153" style="font-family: STIXGeneral-Italic;">𝑛</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">n</script> 条光线……随着追踪深度的增加，计算开销的量级将按照指数级上升。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1qxN8dB1D3KVjSZFyXXbuFpXa-319-237.png" alt=""></p>
<h2 id="蒙特卡洛方法">蒙特卡洛方法</h2>
<p>蒙特卡洛方法（Monte Carlo method）是一种使用概率理论（通过大量随机数采样）进行数值计算以求取积分的方法。一个常用的有助理解的例子是：对「如何计算圆的面积」这个问题（圆的面积公式求取其实也是一个积分问题），蒙特卡洛的解法是「撒豆」：在包含圆的已知面积为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-154" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-155"><span class="mi" id="MathJax-Span-156" style="font-family: STIXGeneral-Italic;">𝑆<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">S</script> 的矩形内随机采样（撒豆）<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-157" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-158"><span class="mi" id="MathJax-Span-159" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">N</script> 次，统计豆在圆内的次数为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-160" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.04em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-161"><span class="mi" id="MathJax-Span-162" style="font-family: STIXGeneral-Italic;">𝑀<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">M</script>，则圆的面积为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-163" style="width: 4.715em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1003.72em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-164"><span class="mi" id="MathJax-Span-165" style="font-family: STIXGeneral-Italic;">𝑆<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-166" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="texatom" id="MathJax-Span-167" style="padding-left: 0.25em;"><span class="mrow" id="MathJax-Span-168"><span class="mi" id="MathJax-Span-169" style="font-family: STIXGeneral-Italic;">𝑀<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span class="texatom" id="MathJax-Span-170"><span class="mrow" id="MathJax-Span-171"><span class="mo" id="MathJax-Span-172" style="font-family: STIXGeneral-Regular;">/</span></span></span><span class="texatom" id="MathJax-Span-173"><span class="mrow" id="MathJax-Span-174"><span class="mi" id="MathJax-Span-175" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi>M</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-29">S\cdot {M} / {N}</script>。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1x2p8dBiE3KVjSZFMXXbQhVXa-251-251.png" alt=""></p>
<blockquote>
<p>撒豆问题不仅可以解圆的面积，还可以解任意形状，甚至不规则形状的面积求取。</p>
</blockquote>
<p>更具体地，蒙特卡洛方法可以表述为：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msubsup&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-176" style="width: 19.745em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 15.677em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1015.68em, 4.02em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-177"><span class="msubsup" id="MathJax-Span-178"><span style="display: inline-block; position: relative; width: 1.639em; height: 0px;"><span style="position: absolute; clip: rect(2.483em, 1001.04em, 5.062em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-179" style="font-family: STIXIntegralsD; vertical-align: -0.593em;">∫<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.449em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.4em, 4.169em, -999.998em); top: -5.107em; left: 1.243em;"><span class="texatom" id="MathJax-Span-180"><span class="mrow" id="MathJax-Span-181"><span class="mi" id="MathJax-Span-182" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑏</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.45em, 4.169em, -999.998em); top: -3.073em; left: 0.598em;"><span class="texatom" id="MathJax-Span-183"><span class="mrow" id="MathJax-Span-184"><span class="mi" id="MathJax-Span-185" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑎</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-186" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-187" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-188" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-189" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-190" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-191" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑑</span><span class="mi" id="MathJax-Span-192" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-193" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">≈</span><span class="munderover" id="MathJax-Span-194" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 3.574em; height: 0px;"><span style="position: absolute; clip: rect(2.879em, 1001.19em, 4.665em, -999.998em); top: -4.015em; left: 1.143em;"><span class="mo" id="MathJax-Span-195" style="font-family: STIXSizeOneSym; vertical-align: -0.543em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1003.52em, 4.417em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-196"><span class="mrow" id="MathJax-Span-197"><span class="mi" id="MathJax-Span-198" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-199" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mi" id="MathJax-Span-200" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-201" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑎</span><span class="mi" id="MathJax-Span-202" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑛</span><span class="mi" id="MathJax-Span-203" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑑</span><span class="mo" id="MathJax-Span-204" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-205" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑎</span><span class="mo" id="MathJax-Span-206" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-207" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-208" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1000.65em, 4.169em, -999.998em); top: -5.206em; left: 1.491em;"><span class="texatom" id="MathJax-Span-209"><span class="mrow" id="MathJax-Span-210"><span class="mi" id="MathJax-Span-211" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-212" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-213" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-214" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-215" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-216" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mfrac" id="MathJax-Span-217" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 2.284em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1002.13em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -1.089em;"><span class="mrow" id="MathJax-Span-218"><span class="mi" id="MathJax-Span-219" style="font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-220" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-221" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1000.89em, 4.169em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="mi" id="MathJax-Span-222" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1002.28em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.284em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.809em; border-left: 0px solid; width: 0px; height: 4.066em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msubsup><mo>∫</mo><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>b</mi></mrow></msubsup><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>d</mi><mi>x</mi><mo>≈</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mo>=</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></munderover><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>⋅</mo><mfrac><mrow><mi>b</mi><mo>−</mo><mi>a</mi></mrow><mi>N</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-30">\begin{equation}\int_{a}^{b} f(x)\cdot dx \approx \sum_{x=rand(a,b)}^{N} f(x) \cdot \frac{b-a}{N} \end{equation}</script></p>
<ol>
<li>左侧表示函数 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-223" style="width: 2.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.838em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.79em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-224"><span class="mi" id="MathJax-Span-225" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-226" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-227" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-228" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-31">f(x)</script> 在区间 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-229" style="width: 2.631em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.99em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-230"><span class="mo" id="MathJax-Span-231" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-232" style="font-family: STIXGeneral-Italic;">𝑎</span><span class="mo" id="MathJax-Span-233" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-234" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑏</span><span class="mo" id="MathJax-Span-235" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-32">[a, b]</script> 的积分，即下图中的部分阴影部分面积。</li>
<li>此积分的值，可以这样求取：随机在 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-236" style="width: 2.631em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.99em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-237"><span class="mo" id="MathJax-Span-238" style="font-family: STIXGeneral-Regular;">[</span><span class="mi" id="MathJax-Span-239" style="font-family: STIXGeneral-Italic;">𝑎</span><span class="mo" id="MathJax-Span-240" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-241" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑏</span><span class="mo" id="MathJax-Span-242" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-33">[a, b]</script> 区间取值，采样计算 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-243" style="width: 2.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.838em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.79em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-244"><span class="mi" id="MathJax-Span-245" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-246" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-247" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-248" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-34">f(x)</script>，然后计算所有样本的均值并乘以区间的长度。当取样数量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-249" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-250"><span class="mi" id="MathJax-Span-251" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-35">N</script> 越大，最后的值就越接近真实的积分值。</li>
</ol>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1CQ0_dEGF3KVjSZFmXXbqPXXa-338-303.png" alt=""></p>
<p>有同学可能会问（我也曾有此困惑），为什么不直接均等分采样，而要随机采样呢？其实，对于计算一维的函数 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-252" style="width: 2.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.838em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.79em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-253"><span class="mi" id="MathJax-Span-254" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-255" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-256" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-257" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-36">f(x)</script>，区别确实不大，但对二维甚至更高维度的函数（此时需要求取重积分）如 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-258" style="width: 3.524em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.78em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.73em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-259"><span class="mi" id="MathJax-Span-260" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-261" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-262" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-263" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-264" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑦</span><span class="mo" id="MathJax-Span-265" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-37">f(x,y)</script>，情况就不一样了。</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msubsup&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;msubsup&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-266" style="width: 35.667em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 28.276em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1028.28em, 5.26em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="msubsup" id="MathJax-Span-268"><span style="display: inline-block; position: relative; width: 1.937em; height: 0px;"><span style="position: absolute; clip: rect(2.483em, 1001.04em, 5.062em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-269" style="font-family: STIXIntegralsD; vertical-align: -0.593em;">∫<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.449em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.75em, 4.318em, -999.998em); top: -5.107em; left: 1.243em;"><span class="texatom" id="MathJax-Span-270"><span class="mrow" id="MathJax-Span-271"><span class="msubsup" id="MathJax-Span-272"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-273" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.35em;"><span class="mn" id="MathJax-Span-274" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.75em, 4.318em, -999.998em); top: -3.073em; left: 0.598em;"><span class="texatom" id="MathJax-Span-275"><span class="mrow" id="MathJax-Span-276"><span class="msubsup" id="MathJax-Span-277"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.35em;"><span class="mn" id="MathJax-Span-279" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-280" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 1.987em; height: 0px;"><span style="position: absolute; clip: rect(2.483em, 1001.04em, 5.062em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-281" style="font-family: STIXIntegralsD; vertical-align: -0.593em;">∫<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.449em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.75em, 4.268em, -999.998em); top: -5.107em; left: 1.243em;"><span class="texatom" id="MathJax-Span-282"><span class="mrow" id="MathJax-Span-283"><span class="msubsup" id="MathJax-Span-284"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-285" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.399em;"><span class="mn" id="MathJax-Span-286" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.75em, 4.268em, -999.998em); top: -3.073em; left: 0.598em;"><span class="texatom" id="MathJax-Span-287"><span class="mrow" id="MathJax-Span-288"><span class="msubsup" id="MathJax-Span-289"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-290" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.399em;"><span class="mn" id="MathJax-Span-291" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-292" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-293" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-294" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-295" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-296" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑦</span><span class="mo" id="MathJax-Span-297" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-298" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-299" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑑</span><span class="mi" id="MathJax-Span-300" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mi" id="MathJax-Span-301" style="font-family: STIXGeneral-Italic;">𝑑</span><span class="mi" id="MathJax-Span-302" style="font-family: STIXGeneral-Italic;">𝑦</span><span class="mo" id="MathJax-Span-303" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">≈</span><span class="munderover" id="MathJax-Span-304" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 4.616em; height: 0px;"><span style="position: absolute; clip: rect(2.879em, 1001.19em, 4.665em, -999.998em); top: -4.015em; left: 1.639em;"><span class="mo" id="MathJax-Span-305" style="font-family: STIXSizeOneSym; vertical-align: -0.543em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.78em, 1004.57em, 5.012em, -999.998em); top: -2.23em; left: 0em;"><span class="texatom" id="MathJax-Span-306"><span class="mrow" id="MathJax-Span-307"><span class="mtable" id="MathJax-Span-308"><span style="display: inline-block; position: relative; width: 4.268em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.83em, 1004.27em, 4.913em, -999.998em); top: -4.015em; left: 0em;"><span style="display: inline-block; position: relative; width: 4.268em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1004.27em, 4.318em, -999.998em); top: -4.561em; left: 50%; margin-left: -2.13em;"><span class="mtd" id="MathJax-Span-309"><span class="mrow" id="MathJax-Span-310"><span class="mi" id="MathJax-Span-311" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-312" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mi" id="MathJax-Span-313" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-314" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑎</span><span class="mi" id="MathJax-Span-315" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑛</span><span class="mi" id="MathJax-Span-316" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑑</span><span class="mo" id="MathJax-Span-317" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-318"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-319" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.399em;"><span class="mn" id="MathJax-Span-320" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-321" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-322"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-323" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.399em;"><span class="mn" id="MathJax-Span-324" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-325" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1004.12em, 4.318em, -999.998em); top: -3.42em; left: 50%; margin-left: -2.081em;"><span class="mtd" id="MathJax-Span-326"><span class="mrow" id="MathJax-Span-327"><span class="mi" id="MathJax-Span-328" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span class="mo" id="MathJax-Span-329" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mi" id="MathJax-Span-330" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-331" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑎</span><span class="mi" id="MathJax-Span-332" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑛</span><span class="mi" id="MathJax-Span-333" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑑</span><span class="mo" id="MathJax-Span-334" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-335"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-336" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.35em;"><span class="mn" id="MathJax-Span-337" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-338" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-339"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-340" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.35em;"><span class="mn" id="MathJax-Span-341" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-342" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1000.65em, 4.169em, -999.998em); top: -5.206em; left: 1.987em;"><span class="texatom" id="MathJax-Span-343"><span class="mrow" id="MathJax-Span-344"><span class="mi" id="MathJax-Span-345" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-346" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-347" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-348" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-349" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-350" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝑦</span><span class="mo" id="MathJax-Span-351" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-352" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mfrac" id="MathJax-Span-353" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 8.435em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.177em, 1008.24em, 4.368em, -999.998em); top: -4.71em; left: 50%; margin-left: -4.164em;"><span class="mrow" id="MathJax-Span-354"><span class="mo" id="MathJax-Span-355" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-356"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-357" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-358" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-359" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-360" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-361" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-362" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-363" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-364" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mo" id="MathJax-Span-365" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="msubsup" id="MathJax-Span-366"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-367" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-368" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-369" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-370" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-371" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-372" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-373" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1000.89em, 4.169em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="mi" id="MathJax-Span-374" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1008.43em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 8.435em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.372em; border-left: 0px solid; width: 0px; height: 5.691em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msubsup><mo>∫</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>y</mi><mn>1</mn></msub></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>y</mi><mn>2</mn></msub></mrow></msubsup><msubsup><mo>∫</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mn>1</mn></msub></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mn>2</mn></msub></mrow></msubsup><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>d</mi><mi>x</mi><mi>d</mi><mi>y</mi><mo>≈</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><mi>x</mi><mo>=</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mi>y</mi><mo>=</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mtd></mtr></mtable></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></munderover><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><mi>N</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-38">\begin{equation}\int_{y_1}^{y_2} \int_{x_1}^{x_2} f(x, y)\cdot dxdy \approx \sum_{ \begin{matrix}x=rand(x_1,x_2) \\ y=rand(y_1,y_2)
\end{matrix}  }^{N} f(x,y) \cdot \frac{(x_2-x_1)\cdot (y_2-y_1)}{N} \end{equation}</script></p>
<p>此时，如果采取均等分采样，就需要选择在 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 3.971em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1003.03em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="mo" id="MathJax-Span-377" style="font-family: STIXGeneral-Regular;">[</span><span class="msubsup" id="MathJax-Span-378"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-379" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-380" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-381" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-382" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-383" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-384" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-385" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-39">[x_1, x_2]</script> 上均等分为若干份，选择在 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-386" style="width: 3.822em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.028em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1002.93em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-387"><span class="mo" id="MathJax-Span-388" style="font-family: STIXGeneral-Regular;">[</span><span class="msubsup" id="MathJax-Span-389"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-390" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-391" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-392" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-393" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-394" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-395" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-396" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-40">[y_1, y_2]</script> 上均等分为若干份（其实撒豆问题已经是二维积分了，只不过积分函数是最简单的二值函数）。随着维度的增加，我们采样的数量也更难以控制，甚至还会出现维度不确定的情况。相比之下，蒙特卡洛方法的随机采样，可以轻易地控制或调整采样的次数：取两次（或更多次数的）随机数，可以视为<strong>单次</strong>随机行为，其背后包含的某种「随机性」是一致的。</p>
<blockquote>
<p>对于光线追踪而言，我们会追踪若干次反射或折射（这个次数又称深度），每一次反射或折射都需要进行一次采样，相当于增加了一个维度。如果每次采样的次数过多，随着深度的增加，总采样次数很快就会不可接受，而如果每次的采样次数过少，（直觉告诉我）那么第一次采样对后续的采样将造成比较大的偏差（这背后应该有更完整的数学解释）。而且，在光线追踪算法中，有时候是否继续进行采样取决于具体的采样值，这就让等分采样变得更加困难。实际上，这份光追算法的实现，在每次反射或折射时只取一个随机样本，而通过增加总总采样次数 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-397" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-398"><span class="mi" id="MathJax-Span-399" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-41">N</script> 来保证最后的结果满足期望。</p>
</blockquote>
<h2 id="光线追踪算法">光线追踪算法</h2>
<p>使用蒙特卡洛方法，对每一次反射或折射不再进行积分，而是随机选取一条可能的反射或折射光线进行追踪。然后在开始追踪的源头处，重复多次追踪操作以求取期望，这就是 SmallPT 光追的算法。简述一下具体步骤：</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1oQmfdAWE3KVjSZSyXXXocXXa-404-306.png" alt=""></p>
<ol>
<li>从每个像素 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-400" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-401"><span class="mi" id="MathJax-Span-402" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-42">P</script> 处发出一条射线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-403" style="width: 0.945em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-404"><span class="mi" id="MathJax-Span-405" style="font-family: STIXGeneral-Italic;">𝑅</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-43">R</script>，其方向与入射到相机并产生该像素的光线相反。</li>
<li>求取此射线照射到的物体表面的点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-406" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-407"><span class="msubsup" id="MathJax-Span-408"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-409" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-410" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-44">P_1</script>，即与场景中物体的交点；如有多个交点，取距离相机最近的那个。如果未求到交点，则返回背景色。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-411" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-412"><span class="msubsup" id="MathJax-Span-413"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-414" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-415" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-45">P_1</script> 射向 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-416" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-417"><span class="mi" id="MathJax-Span-418" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-46">P</script> 的光线强度，为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-419" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="msubsup" id="MathJax-Span-421"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-422" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-423" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-47">P_1</script> 本身发射光强度 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-424" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-425"><span class="mi" id="MathJax-Span-426" style="font-family: STIXGeneral-Italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-48">E</script>，加上反射或折射环境光的强度。<ol>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-427" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-428"><span class="mi" id="MathJax-Span-429" style="font-family: STIXGeneral-Italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">E</script>：如果 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-430" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-431"><span class="msubsup" id="MathJax-Span-432"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-433" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-434" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-50">P_1</script> 处是光源，则 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-435" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-436"><span class="mi" id="MathJax-Span-437" style="font-family: STIXGeneral-Italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">E</script> 为光源的强度；否则，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-438" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-439"><span class="mi" id="MathJax-Span-440" style="font-family: STIXGeneral-Italic;">𝐸<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">E</script> 为 0。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-441" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-442"><span class="msubsup" id="MathJax-Span-443"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-444" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-445" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-53">R_1</script>：根据 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-446" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-447"><span class="msubsup" id="MathJax-Span-448"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-449" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-450" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-54">P_1</script> 处根据表面性质，按概率随机取<strong>一次</strong>反射的射线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-451" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-452"><span class="msubsup" id="MathJax-Span-453"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-454" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-455" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-55">R_2</script>，然后重复 2 的步骤，分别递归地求取 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-456" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-457"><span class="msubsup" id="MathJax-Span-458"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-459" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-460" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-56">P_2</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-461" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-462"><span class="msubsup" id="MathJax-Span-463"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-464" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-465" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>3</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-57">R_3</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-466" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-467"><span class="msubsup" id="MathJax-Span-468"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-469" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-470" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>3</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-58">P_3</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-471" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-472"><span class="msubsup" id="MathJax-Span-473"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-474" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-475" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">4</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>4</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-59">R_4</script> ……等等，直到满足一些特定条件停止递归。</li>
</ol>
</li>
</ol>
<p>以上便是单个像素的光追的算法。对单个像素，重复大量的次数求取平均值，作为此像素的颜色。</p>
<p>对每个像素完成以上步骤，就渲染出了整幅图像。</p>
<h2 id="代码摘录">代码摘录</h2>
<p>完整的代码摘抄如下：</p>
<pre><code class="language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;math.h&gt;   // smallpt, a Path Tracer by Kevin Beason, 2008</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt; // Make : g++ -O3 -fopenmp smallpt.cpp -o smallpt</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;  //        Remove "-fopenmp" for g++ version &lt; 4.2</span></span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Vec</span> {</span>        <span class="hljs-comment">// Usage: time ./smallpt 5000 &amp;&amp; xv image.ppm</span>
  <span class="hljs-keyword">double</span> x, y, z;                  <span class="hljs-comment">// position, also color (r,g,b)</span>
  Vec(<span class="hljs-keyword">double</span> x_=<span class="hljs-number">0</span>, <span class="hljs-keyword">double</span> y_=<span class="hljs-number">0</span>, <span class="hljs-keyword">double</span> z_=<span class="hljs-number">0</span>){ x=x_; y=y_; z=z_; }
  Vec <span class="hljs-keyword">operator</span>+(<span class="hljs-keyword">const</span> Vec &amp;b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x+b.x,y+b.y,z+b.z); }
  Vec <span class="hljs-keyword">operator</span>-(<span class="hljs-keyword">const</span> Vec &amp;b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x-b.x,y-b.y,z-b.z); }
  Vec <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">double</span> b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x*b,y*b,z*b); }
  <span class="hljs-function">Vec <span class="hljs-title">mult</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Vec &amp;b)</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> Vec(x*b.x,y*b.y,z*b.z); }
  <span class="hljs-function">Vec&amp; <span class="hljs-title">norm</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span> = *<span class="hljs-keyword">this</span> * (<span class="hljs-number">1</span>/<span class="hljs-built_in">sqrt</span>(x*x+y*y+z*z)); }
  <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">dot</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Vec &amp;b)</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> x*b.x+y*b.y+z*b.z; } <span class="hljs-comment">// cross:</span>
  Vec <span class="hljs-keyword">operator</span>%(Vec&amp;b){<span class="hljs-keyword">return</span> Vec(y*b.z-z*b.y,z*b.x-x*b.z,x*b.y-y*b.x);}
};
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Ray</span> {</span> Vec o, d; Ray(Vec o_, Vec d_) : o(o_), d(d_) {} };
<span class="hljs-keyword">enum</span> Refl_t { DIFF, SPEC, REFR };  <span class="hljs-comment">// material types, used in radiance()</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Sphere</span> {</span>
  <span class="hljs-keyword">double</span> rad;       <span class="hljs-comment">// radius</span>
  Vec p, e, c;      <span class="hljs-comment">// position, emission, color</span>
  Refl_t refl;      <span class="hljs-comment">// reflection type (DIFFuse, SPECular, REFRactive)</span>
  Sphere(<span class="hljs-keyword">double</span> rad_, Vec p_, Vec e_, Vec c_, Refl_t refl_):
  rad(rad_), p(p_), e(e_), c(c_), refl(refl_) {}
  <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">intersect</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Ray &amp;r)</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-comment">// returns distance, 0 if nohit</span>
    Vec op = p-r.o; <span class="hljs-comment">// Solve t^2*d.d + 2*t*(o-p).d + (o-p).(o-p)-R^2 = 0</span>
    <span class="hljs-keyword">double</span> t, eps=<span class="hljs-number">1e-4</span>, b=op.dot(r.d), det=b*b-op.dot(op)+rad*rad;
    <span class="hljs-keyword">if</span> (det&lt;<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-keyword">else</span> det=<span class="hljs-built_in">sqrt</span>(det);
      <span class="hljs-keyword">return</span> (t=b-det)&gt;eps ? t : ((t=b+det)&gt;eps ? t : <span class="hljs-number">0</span>);
  }
};
Sphere spheres[] = {<span class="hljs-comment">//Scene: radius, position, emission, color, material</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec( <span class="hljs-number">1e5</span>+<span class="hljs-number">1</span>,<span class="hljs-number">40.8</span>,<span class="hljs-number">81.6</span>), Vec(),Vec(<span class="hljs-number">.75</span>,<span class="hljs-number">.25</span>,<span class="hljs-number">.25</span>),DIFF),<span class="hljs-comment">//Left</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec(<span class="hljs-number">-1e5</span>+<span class="hljs-number">99</span>,<span class="hljs-number">40.8</span>,<span class="hljs-number">81.6</span>),Vec(),Vec(<span class="hljs-number">.25</span>,<span class="hljs-number">.25</span>,<span class="hljs-number">.75</span>),DIFF),<span class="hljs-comment">//Rght</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec(<span class="hljs-number">50</span>,<span class="hljs-number">40.8</span>, <span class="hljs-number">1e5</span>),     Vec(),Vec(<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>),DIFF),<span class="hljs-comment">//Back</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec(<span class="hljs-number">50</span>,<span class="hljs-number">40.8</span>,<span class="hljs-number">-1e5</span>+<span class="hljs-number">170</span>), Vec(),Vec(),           DIFF),<span class="hljs-comment">//Frnt</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec(<span class="hljs-number">50</span>, <span class="hljs-number">1e5</span>, <span class="hljs-number">81.6</span>),    Vec(),Vec(<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>),DIFF),<span class="hljs-comment">//Botm</span>
  Sphere(<span class="hljs-number">1e5</span>, Vec(<span class="hljs-number">50</span>,<span class="hljs-number">-1e5</span>+<span class="hljs-number">81.6</span>,<span class="hljs-number">81.6</span>),Vec(),Vec(<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>,<span class="hljs-number">.75</span>),DIFF),<span class="hljs-comment">//Top</span>
  Sphere(<span class="hljs-number">16.5</span>,Vec(<span class="hljs-number">27</span>,<span class="hljs-number">16.5</span>,<span class="hljs-number">47</span>),       Vec(),Vec(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)*<span class="hljs-number">.999</span>, SPEC),<span class="hljs-comment">//Mirr</span>
  Sphere(<span class="hljs-number">16.5</span>,Vec(<span class="hljs-number">73</span>,<span class="hljs-number">16.5</span>,<span class="hljs-number">78</span>),       Vec(),Vec(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)*<span class="hljs-number">.999</span>, REFR),<span class="hljs-comment">//Glas</span>
  Sphere(<span class="hljs-number">600</span>, Vec(<span class="hljs-number">50</span>,<span class="hljs-number">681.6</span><span class="hljs-number">-.27</span>,<span class="hljs-number">81.6</span>),Vec(<span class="hljs-number">12</span>,<span class="hljs-number">12</span>,<span class="hljs-number">12</span>),  Vec(), DIFF) <span class="hljs-comment">//Lite</span>
};
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">clamp</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x)</span></span>{ <span class="hljs-keyword">return</span> x&lt;<span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : x&gt;<span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : x; }
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">toInt</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x)</span></span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">int</span>(<span class="hljs-built_in">pow</span>(clamp(x),<span class="hljs-number">1</span>/<span class="hljs-number">2.2</span>)*<span class="hljs-number">255</span>+<span class="hljs-number">.5</span>); }
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">intersect</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Ray &amp;r, <span class="hljs-keyword">double</span> &amp;t, <span class="hljs-keyword">int</span> &amp;id)</span></span>{
  <span class="hljs-keyword">double</span> n=<span class="hljs-keyword">sizeof</span>(spheres)/<span class="hljs-keyword">sizeof</span>(Sphere), d, inf=t=<span class="hljs-number">1e20</span>;
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-keyword">int</span>(n);i--;) <span class="hljs-keyword">if</span>((d=spheres[i].intersect(r))&amp;&amp;d&lt;t){t=d;id=i;}
  <span class="hljs-keyword">return</span> t&lt;inf;
}
<span class="hljs-function">Vec <span class="hljs-title">radiance</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Ray &amp;r, <span class="hljs-keyword">int</span> depth, <span class="hljs-keyword">unsigned</span> short *Xi)</span></span>{
  <span class="hljs-keyword">double</span> t;                               <span class="hljs-comment">// distance to intersection</span>
  <span class="hljs-keyword">int</span> id=<span class="hljs-number">0</span>;                               <span class="hljs-comment">// id of intersected object</span>
  <span class="hljs-keyword">if</span> (!intersect(r, t, id)) <span class="hljs-keyword">return</span> Vec(); <span class="hljs-comment">// if miss, return black</span>
  <span class="hljs-keyword">const</span> Sphere &amp;obj = spheres[id];        <span class="hljs-comment">// the hit object</span>
  Vec x=r.o+r.d*t, n=(x-obj.p).norm(), nl=n.dot(r.d)&lt;<span class="hljs-number">0</span>?n:n*<span class="hljs-number">-1</span>, f=obj.c;
  <span class="hljs-keyword">double</span> p = f.x&gt;f.y &amp;&amp; f.x&gt;f.z ? f.x : f.y&gt;f.z ? f.y : f.z; <span class="hljs-comment">// max refl</span>
  <span class="hljs-keyword">if</span> (++depth&gt;<span class="hljs-number">5</span>) <span class="hljs-keyword">if</span> (erand48(Xi)&lt;p) f=f*(<span class="hljs-number">1</span>/p); <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> obj.e; <span class="hljs-comment">//R.R.</span>
  <span class="hljs-keyword">if</span> (obj.refl == DIFF){                  <span class="hljs-comment">// Ideal DIFFUSE reflection</span>
    <span class="hljs-keyword">double</span> r1=<span class="hljs-number">2</span>*M_PI*erand48(Xi), r2=erand48(Xi), r2s=<span class="hljs-built_in">sqrt</span>(r2);
    Vec w=nl, u=((<span class="hljs-built_in">fabs</span>(w.x)&gt;<span class="hljs-number">.1</span>?Vec(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>):Vec(<span class="hljs-number">1</span>))%w).norm(), v=w%u;
    Vec d = (u*<span class="hljs-built_in">cos</span>(r1)*r2s + v*<span class="hljs-built_in">sin</span>(r1)*r2s + w*<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1</span>-r2)).norm();
    <span class="hljs-keyword">return</span> obj.e + f.mult(radiance(Ray(x,d),depth,Xi));
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj.refl == SPEC)            <span class="hljs-comment">// Ideal SPECULAR reflection</span>
    <span class="hljs-keyword">return</span> obj.e + f.mult(radiance(Ray(x,r.d-n*<span class="hljs-number">2</span>*n.dot(r.d)),depth,Xi));
  <span class="hljs-function">Ray <span class="hljs-title">reflRay</span><span class="hljs-params">(x, r.d-n*<span class="hljs-number">2</span>*n.dot(r.d))</span></span>;     <span class="hljs-comment">// Ideal dielectric REFRACTION</span>
  <span class="hljs-keyword">bool</span> into = n.dot(nl)&gt;<span class="hljs-number">0</span>;                <span class="hljs-comment">// Ray from outside going in?</span>
  <span class="hljs-keyword">double</span> nc=<span class="hljs-number">1</span>, nt=<span class="hljs-number">1.5</span>, nnt=into?nc/nt:nt/nc, ddn=r.d.dot(nl), cos2t;
  <span class="hljs-keyword">if</span> ((cos2t=<span class="hljs-number">1</span>-nnt*nnt*(<span class="hljs-number">1</span>-ddn*ddn))&lt;<span class="hljs-number">0</span>)    <span class="hljs-comment">// Total internal reflection</span>
    <span class="hljs-keyword">return</span> obj.e + f.mult(radiance(reflRay,depth,Xi));
  Vec tdir = (r.d*nnt - n*((into?<span class="hljs-number">1</span>:<span class="hljs-number">-1</span>)*(ddn*nnt+<span class="hljs-built_in">sqrt</span>(cos2t)))).norm();
  <span class="hljs-keyword">double</span> a=nt-nc, b=nt+nc, R0=a*a/(b*b), c = <span class="hljs-number">1</span>-(into?-ddn:tdir.dot(n));
  <span class="hljs-keyword">double</span> Re=R0+(<span class="hljs-number">1</span>-R0)*c*c*c*c*c,Tr=<span class="hljs-number">1</span>-Re,P=<span class="hljs-number">.25</span>+<span class="hljs-number">.5</span>*Re,RP=Re/P,TP=Tr/(<span class="hljs-number">1</span>-P);
  <span class="hljs-keyword">return</span> obj.e + f.mult(depth&gt;<span class="hljs-number">2</span> ? (erand48(Xi)&lt;P ? <span class="hljs-comment">// Russian roulette</span>
    radiance(reflRay,depth,Xi)*RP:radiance(Ray(x,tdir),depth,Xi)*TP) :
    radiance(reflRay,depth,Xi)*Re+radiance(Ray(x,tdir),depth,Xi)*Tr);
}
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span>{
  <span class="hljs-keyword">int</span> w=<span class="hljs-number">1024</span>/<span class="hljs-number">8</span>, h=<span class="hljs-number">768</span>/<span class="hljs-number">8</span>, samps = argc==<span class="hljs-number">2</span> ? atoi(argv[<span class="hljs-number">1</span>])/<span class="hljs-number">4</span> : <span class="hljs-number">30</span>;
  <span class="hljs-function">Ray <span class="hljs-title">cam</span><span class="hljs-params">(Vec(<span class="hljs-number">50</span>,<span class="hljs-number">52</span>,<span class="hljs-number">295.6</span>), Vec(<span class="hljs-number">0</span>,<span class="hljs-number">-0.042612</span>,<span class="hljs-number">-1</span>).norm())</span></span>; <span class="hljs-comment">// cam pos, dir</span>
  Vec cx=Vec(w*<span class="hljs-number">.5135</span>/h), cy=(cx%cam.d).norm()*<span class="hljs-number">.5135</span>, r, *c=<span class="hljs-keyword">new</span> Vec[w*h];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y=<span class="hljs-number">0</span>; y&lt;h; y++){                       <span class="hljs-comment">// Loop over image rows</span>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">"\rRendering (%d spp) %5.2f%%"</span>,samps*<span class="hljs-number">4</span>,<span class="hljs-number">100.</span>*y/(h<span class="hljs-number">-1</span>));
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> short x=<span class="hljs-number">0</span>, Xi[<span class="hljs-number">3</span>]={<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,(<span class="hljs-keyword">unsigned</span> short)(y*y*y)}; x&lt;w; x++)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sy=<span class="hljs-number">0</span>, i=(h-y<span class="hljs-number">-1</span>)*w+x; sy&lt;<span class="hljs-number">2</span>; sy++)     <span class="hljs-comment">// 2x2 subpixel rows</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sx=<span class="hljs-number">0</span>; sx&lt;<span class="hljs-number">2</span>; sx++, r=Vec()){        <span class="hljs-comment">// 2x2 subpixel cols</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s=<span class="hljs-number">0</span>; s&lt;samps; s++){
            <span class="hljs-keyword">double</span> r1=<span class="hljs-number">2</span>*erand48(Xi), dx=r1&lt;<span class="hljs-number">1</span> ? <span class="hljs-built_in">sqrt</span>(r1)<span class="hljs-number">-1</span>: <span class="hljs-number">1</span>-<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>-r1);
            <span class="hljs-keyword">double</span> r2=<span class="hljs-number">2</span>*erand48(Xi), dy=r2&lt;<span class="hljs-number">1</span> ? <span class="hljs-built_in">sqrt</span>(r2)<span class="hljs-number">-1</span>: <span class="hljs-number">1</span>-<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>-r2);
            Vec d = cx*( ( (sx+<span class="hljs-number">.5</span> + dx)/<span class="hljs-number">2</span> + x)/w - <span class="hljs-number">.5</span>) +
            cy*( ( (sy+<span class="hljs-number">.5</span> + dy)/<span class="hljs-number">2</span> + y)/h - <span class="hljs-number">.5</span>) + cam.d;
            r = r + radiance(Ray(cam.o+d*<span class="hljs-number">140</span>,d.norm()),<span class="hljs-number">0</span>,Xi)*(<span class="hljs-number">1.</span>/samps);
          } <span class="hljs-comment">// Camera rays are pushed ^^^^^ forward to start in interior</span>
          c[i] = c[i] + Vec(clamp(r.x),clamp(r.y),clamp(r.z))*<span class="hljs-number">.25</span>;
        }
  }
  FILE *f = fopen(<span class="hljs-string">"image.ppm"</span>, <span class="hljs-string">"w"</span>);         <span class="hljs-comment">// Write image to PPM file.</span>
  <span class="hljs-built_in">fprintf</span>(f, <span class="hljs-string">"P3\n%d %d\n%d\n"</span>, w, h, <span class="hljs-number">255</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;w*h; i++)
    <span class="hljs-built_in">fprintf</span>(f,<span class="hljs-string">"%d %d %d "</span>, toInt(c[i].x), toInt(c[i].y), toInt(c[i].z));
}</code></pre>
<p>本文的主要部分，就是对这段代码的解析：</p>
<h2 id="矢量运算">矢量运算</h2>
<p>定义 <code>Vec</code> 结构体描述三维矢量，重载运算符来实现矢量运算。</p>
<pre><code class="language-cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Vec</span> {</span>
  <span class="hljs-keyword">double</span> x, y, z;
  Vec(<span class="hljs-keyword">double</span> x_=<span class="hljs-number">0</span>, <span class="hljs-keyword">double</span> y_=<span class="hljs-number">0</span>, <span class="hljs-keyword">double</span> z_=<span class="hljs-number">0</span>){ x=x_; y=y_; z=z_; }
  Vec <span class="hljs-keyword">operator</span>+(<span class="hljs-keyword">const</span> Vec &amp;b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x+b.x,y+b.y,z+b.z); }
  Vec <span class="hljs-keyword">operator</span>-(<span class="hljs-keyword">const</span> Vec &amp;b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x-b.x,y-b.y,z-b.z); }
  Vec <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">double</span> b) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> Vec(x*b,y*b,z*b); }
  <span class="hljs-function">Vec <span class="hljs-title">mult</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Vec &amp;b)</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> Vec(x*b.x,y*b.y,z*b.z); }
  <span class="hljs-function">Vec&amp; <span class="hljs-title">norm</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span> = *<span class="hljs-keyword">this</span> * (<span class="hljs-number">1</span>/<span class="hljs-built_in">sqrt</span>(x*x+y*y+z*z)); }
  <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">dot</span><span class="hljs-params">(<span class="hljs-keyword">const</span> Vec &amp;b)</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> x*b.x+y*b.y+z*b.z; }
  Vec <span class="hljs-keyword">operator</span>%(Vec&amp;b){<span class="hljs-keyword">return</span> Vec(y*b.z-z*b.y,z*b.x-x*b.z,x*b.y-y*b.x);}
};</code></pre>
<p>矢量运算包括（假设 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-476" style="width: 8.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.749em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1006.7em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-477"><span class="msubsup" id="MathJax-Span-478"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-479" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-480" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-481" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-482" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-483"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-484" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-485" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-486" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-487" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-488" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-489" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-490" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-491" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-492" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-493" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-494" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-60">V_1=(x_1, y_1, z_1)</script>；<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-495" style="width: 8.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.749em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1006.7em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-496"><span class="msubsup" id="MathJax-Span-497"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-498" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-499" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-500" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-501" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-502"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-503" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-504" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-505" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-506" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-507" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-508" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-509" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-510" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-511" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-512" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-513" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-61">V_2=(x_2,y_2,z_2)</script>）：</p>
<ol>
<li>加法 <code>operator+</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-514" style="width: 19.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.33em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1015.28em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-515"><span class="msubsup" id="MathJax-Span-516"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-517" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-518" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-519" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-520" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-521" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-522" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-523" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-524" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-525"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-526" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-527" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-528" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-529" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-530" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-531" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-532" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-533" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-534" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-535" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-536" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-537" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-538" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-539" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-540" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-541" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-542" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-543" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-544" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-545" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-546" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-547" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-548" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>+</mo><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mo>+</mo><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-62">V_1+V_2=(x_1+x_2,y_1+y_2,z_1+z_2)</script>。</li>
<li>减法 <code>operator-</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-549" style="width: 19.348em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.33em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1015.28em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-550"><span class="msubsup" id="MathJax-Span-551"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-552" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-553" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-554" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-555" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-556" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-557" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-558" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-559" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-560"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-561" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-562" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-563" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-564" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-565" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-566" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-567" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-568" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-569" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-570" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-571" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-572" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-573" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-574" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-575" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-576" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-577" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-578" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-579" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-580" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-581" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-582" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-583" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>−</mo><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mo>−</mo><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-63">V_1-V_2=(x_1-x_2,y_1-y_2,z_1-z_2)</script>。</li>
<li>乘法 <code>mult()</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-584" style="width: 17.066em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.544em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1013.5em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-585"><span class="mi" id="MathJax-Span-586" style="font-family: STIXGeneral-Italic;">𝑚</span><span class="mi" id="MathJax-Span-587" style="font-family: STIXGeneral-Italic;">𝑢</span><span class="mi" id="MathJax-Span-588" style="font-family: STIXGeneral-Italic;">𝑙</span><span class="mi" id="MathJax-Span-589" style="font-family: STIXGeneral-Italic;">𝑡</span><span class="mo" id="MathJax-Span-590" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-591"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-592" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-593" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-594" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-595" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-596" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-597" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-598" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-599" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-600" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-601"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-602" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-603" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-604"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-605" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-606" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-607" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-608" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-609" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-610" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-611"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-612" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-613" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-614" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-615" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-616" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-617" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-618"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-619" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-620" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-621" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi><mi>u</mi><mi>l</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>V</mi><mn>1</mn></msub><mo>,</mo><msub><mi>V</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-64">mult(V_1, V_2)=(x_1 x_2,y_1 y_2,z_1 z_2)</script>。这种矢量分量直接相乘的运算通常用于颜色的计算，在三维空间中并无特殊的物理意义。</li>
<li>点乘 <code>dot()</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-622" style="width: 20.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.173em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1016.17em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-623"><span class="msubsup" id="MathJax-Span-624"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-625" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-626" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-627" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="msubsup" id="MathJax-Span-628" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-629" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-630" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-631" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-632" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-633"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-634" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-635" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-636"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-637" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-638" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-639" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-640" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-641" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-642" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-643"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-644" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-645" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-646" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-647" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-648" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-649" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-650"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-651" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-652" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-653" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-654" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-655" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">cos</span><span class="mo" id="MathJax-Span-656"></span><span class="mi" id="MathJax-Span-657" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>⋅</mo><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><mo>+</mo><msub><mi>z</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">V_1\cdot V_2 = (x_1 x_2 + y_1 y_2 + z_1 z_2) = \cos\theta</script>，其中 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-658" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-659"><span class="mi" id="MathJax-Span-660" style="font-family: STIXGeneral-Italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-66">\theta</script> 为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-661" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-662"><span class="msubsup" id="MathJax-Span-663"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-664" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-665" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-67">V_1</script> 与 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-666" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-667"><span class="msubsup" id="MathJax-Span-668"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-669" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-670" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-68">V_2</script> 的夹角。点乘的结果是一个标量，物理含义是 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-671" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-672"><span class="msubsup" id="MathJax-Span-673"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-674" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-675" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-69">V_1</script> 在 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-676" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-677"><span class="msubsup" id="MathJax-Span-678"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-679" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-680" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-70">V_2</script> 方向上的投影。</li>
<li>叉乘 <code>operator%</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-681" style="width: 26.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.084em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1021.03em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-682"><span class="msubsup" id="MathJax-Span-683"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-684" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-685" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-686" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">×</span><span class="msubsup" id="MathJax-Span-687" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-688" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-689" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-690" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-691" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-692"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-693" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-694" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-695"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-696" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-697" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-698" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-699" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-700" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-701" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-702"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-703" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-704" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-705" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-706" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-707" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-708" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-709"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-710" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-711" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-712" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-713" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-714" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-715" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-716"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-717" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-718" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-719" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-720" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-721" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-722" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-723"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-724" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-725" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-726" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-727" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-728" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-729" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-730"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-731" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-732" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-733" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>×</mo><msub><mi>V</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub><mo>−</mo><msub><mi>z</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub><mo>,</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-71">V_1\times V_2 = (y_1 z_2 - z_1 y_2, z_1 x_2 - x_1 z_2, x_1 y_2 - y_1 x_2)</script>，叉乘的结果是一个矢量，物理意义是垂直于 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-734" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-735"><span class="msubsup" id="MathJax-Span-736"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-737" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-738" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-72">V_1</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-739" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-740"><span class="msubsup" id="MathJax-Span-741"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-742" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-743" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-73">V_2</script> 的矢量（按 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-744" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1003.52em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-745"><span class="msubsup" id="MathJax-Span-746"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-747" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-748" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-749" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">→</span><span class="msubsup" id="MathJax-Span-750" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-751" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-752" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo stretchy="false">→</mo><msub><mi>V</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-74">V_1\rightarrow V_2</script> 顺序右手螺旋），其长度为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-753" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-754"><span class="msubsup" id="MathJax-Span-755"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-756" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-757" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-75">V_1</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-758" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-759"><span class="msubsup" id="MathJax-Span-760"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-761" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-762" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-76">V_2</script> 构成的平行四边形面积。</li>
<li>矢量乘以标量 <code>operator*</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-763" style="width: 12.155em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.625em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1009.58em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-764"><span class="msubsup" id="MathJax-Span-765"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-766" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-767" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-768" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-769" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑏</span><span class="mo" id="MathJax-Span-770" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-771" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-772"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-773" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="mn" id="MathJax-Span-774" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-775" style="font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-776" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-777" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-778" style="font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-779" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-780" style="font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-781" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-782" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-783" style="font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-784" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-785" style="font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-786" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mn>1</mn></msub><mo>∗</mo><mi>b</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mi>b</mi><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mi>b</mi><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mi>b</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-77">V_1 * b = (x_1 b, y_1 b, z_1 b)</script>。</li>
<li>归一化 <code>norm()</code>：<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;msqrt&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-787" style="width: 13.941em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.064em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1011.06em, 3.822em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-788"><span class="mi" id="MathJax-Span-789" style="font-family: STIXGeneral-Italic;">𝑛</span><span class="mi" id="MathJax-Span-790" style="font-family: STIXGeneral-Italic;">𝑜</span><span class="mi" id="MathJax-Span-791" style="font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-792" style="font-family: STIXGeneral-Italic;">𝑚</span><span class="mo" id="MathJax-Span-793" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-794"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-795" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-796" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-797" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-798" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-799" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-800" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-801" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-802" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mfrac" id="MathJax-Span-803" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 3.822em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.375em, 1000.3em, 4.169em, -999.998em); top: -4.412em; left: 50%; margin-left: -0.196em;"><span class="mn" id="MathJax-Span-804" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1003.72em, 4.665em, -999.998em); top: -3.271em; left: 50%; margin-left: -1.833em;"><span class="msqrt" id="MathJax-Span-805"><span style="display: inline-block; position: relative; width: 3.723em; height: 0px;"><span style="position: absolute; clip: rect(3.276em, 1002.98em, 4.368em, -999.998em); top: -4.015em; left: 0.747em;"><span class="mrow" id="MathJax-Span-806"><span class="msubsup" id="MathJax-Span-807"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-808" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -4.263em; left: 0.399em;"><span class="mn" id="MathJax-Span-809" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -3.817em; left: 0.399em;"><span class="mn" id="MathJax-Span-810" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-811" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="msubsup" id="MathJax-Span-812"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-813" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -4.263em; left: 0.35em;"><span class="mn" id="MathJax-Span-814" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -3.817em; left: 0.35em;"><span class="mn" id="MathJax-Span-815" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-816" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">+</span><span class="msubsup" id="MathJax-Span-817"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-818" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑧</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -4.263em; left: 0.35em;"><span class="mn" id="MathJax-Span-819" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.3em, 4.169em, -999.998em); top: -3.817em; left: 0.35em;"><span class="mn" id="MathJax-Span-820" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.945em, 1002.98em, 1.243em, -999.998em); top: -1.882em; left: 0.747em;"><span style="display: inline-block; overflow: hidden; vertical-align: -0.047em; border-top: 1.3px solid; width: 2.979em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span><span style="position: absolute; clip: rect(2.78em, 1000.8em, 4.368em, -999.998em); top: -3.767em; left: 0em;"><span><span style="font-size: 70.7%; font-family: STIXSizeOneSym;">√</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1003.82em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.822em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 2.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mo stretchy="false">(</mo><msub><mi>V</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>V</mi><mn>1</mn></msub><mo>∗</mo><mfrac><mn>1</mn><msqrt><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>y</mi><mn>1</mn><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>z</mi><mn>1</mn><mn>2</mn></msubsup></msqrt></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-78">norm(V_1) = V_1 * \frac{1}{\sqrt {x_1^2+y_1^2+z_1^2}}</script>，其物理意义是保持矢量方向不变，将其长度缩放为单位长度 1。</li>
</ol>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1S5indBWD3KVjSZKPXXap7FXa-529-277.png" alt=""></p>
<h2 id="射线">射线</h2>
<p>通过定义射线的出射点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-821" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.45em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-822"><span class="mi" id="MathJax-Span-823" style="font-family: STIXGeneral-Italic;">𝑜</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>o</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">o</script> 和出射方向 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-824" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.55em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-825"><span class="mi" id="MathJax-Span-826" style="font-family: STIXGeneral-Italic;">𝑑</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-80">d</script> 来定义射线：</p>
<pre><code class="language-cpp"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Ray</span> {</span> Vec o, d; Ray(Vec o_, Vec d_) : o(o_), d(d_) {} };</code></pre>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1rxmmdvWG3KVjSZFgXXbTspXa-298-123.png" alt=""></p>
<h2 id="定义场景">定义场景</h2>
<p>如前文 SmallPT 的渲染效果图所示，整个场景由一个房间，一个光源和两个球体组成。为了简单，SmallPT 将场景全部用球体来表示，房间的墙壁就用直径极大（使观者感受不到墙壁是弯曲的）的球体来表示。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1V8mHdBCw3KVjSZFlXXcJkFXa-226-175.png" alt=""></p>
<h3 id="球体对象的表示">球体对象的表示</h3>
<ol>
<li>首先枚举出三种表面特性：散射面——用于墙壁，镜面——用于左侧的镜面小球，折射面——用于右侧的玻璃小球。</li>
<li>定义球体，内容包括：<ol>
<li>数值类型成员：半径 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-827" style="width: 1.838em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.44em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-828"><span class="mi" id="MathJax-Span-829" style="font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-830" style="font-family: STIXGeneral-Italic;">𝑎</span><span class="mi" id="MathJax-Span-831" style="font-family: STIXGeneral-Italic;">𝑑</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mi>a</mi><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-81">rad</script>；</li>
<li>矢量类型成员：圆心位置 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-832" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.5em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-833"><span class="mi" id="MathJax-Span-834" style="font-family: STIXGeneral-Italic;">𝑝</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-82">p</script>，表面发光强度（颜色）<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-835" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.4em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-836"><span class="mi" id="MathJax-Span-837" style="font-family: STIXGeneral-Italic;">𝑒</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-83">e</script>，表面散射颜色 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-838" style="width: 0.499em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.399em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.4em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-839"><span class="mi" id="MathJax-Span-840" style="font-family: STIXGeneral-Italic;">𝑐</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">c</script>；</li>
<li>表面特性 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-841" style="width: 2.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.74em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-842"><span class="mi" id="MathJax-Span-843" style="font-family: STIXGeneral-Italic;">𝑟</span><span class="mi" id="MathJax-Span-844" style="font-family: STIXGeneral-Italic;">𝑒</span><span class="mi" id="MathJax-Span-845" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mi" id="MathJax-Span-846" style="font-family: STIXGeneral-Italic;">𝑙</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mi>e</mi><mi>f</mi><mi>l</mi></math></span></span><script type="math/tex" id="MathJax-Element-85">refl</script>；</li>
</ol>
</li>
</ol>
<pre><code class="language-cpp"><span class="hljs-keyword">enum</span> Refl_t { DIFF, SPEC, REFR };  <span class="hljs-comment">// material types, used in radiance()</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Sphere</span> {</span>
  <span class="hljs-keyword">double</span> rad;       <span class="hljs-comment">// radius</span>
  Vec p, e, c;      <span class="hljs-comment">// position, emission, color</span>
  Refl_t refl;      <span class="hljs-comment">// reflection type (DIFFuse, SPECular, REFRactive)</span>
  Sphere(<span class="hljs-keyword">double</span> rad_, Vec p_, Vec e_, Vec c_, Refl_t refl_):
  rad(rad_), p(p_), e(e_), c(c_), refl(refl_) {}
  <span class="hljs-comment">// ...</span>
};</code></pre>
<h3 id="射线与球体相交">射线与球体相交</h3>
<p><code>Sphere</code> 上定义了 <code>intersect</code> 方法，以求取给定的射线与球体是不是相交。如果相交则返回射线原点与交点的距离。</p>
<pre><code class="language-c">double intersect(const Ray &amp;r) const { // returns distance, 0 if nohit
  Vec op = p-r.o; // Solve t^2*d.d + 2*t*(o-p).d + (o-p).(o-p)-R^2 = 0
  double t, eps=1e-4, b=op.dot(r.d), det=b*b-op.dot(op)+rad*rad;
  if (det&lt;0) return 0; else det=sqrt(det);
    return (t=b-det)&gt;eps ? t : ((t=b+det)&gt;eps ? t : 0);
}</code></pre>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1tA1Sckxz61VjSZFtXXaDSVXa-430-152.png" alt=""></p>
<p>注意，下面为了清楚，我们使用大写字母为矢量，小写字母为标量来进行推导。我们需要求解的是射线的原点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-847" style="width: 0.945em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-848"><span class="mi" id="MathJax-Span-849" style="font-family: STIXGeneral-Italic;">𝑂</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>O</mi></math></span></span><script type="math/tex" id="MathJax-Element-86">O</script> 与交点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-850" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-851"><span class="mi" id="MathJax-Span-852" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">X</script> 的距离 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-853" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.788em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-854"><span class="mi" id="MathJax-Span-855" style="font-family: STIXGeneral-Italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">t</script>，而条件是：</p>
<ol>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-856" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-857"><span class="mi" id="MathJax-Span-858" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-89">X</script> 点在射线上，即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-859" style="width: 7.691em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.104em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1006.05em, 2.681em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-860"><span class="mi" id="MathJax-Span-861" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-862" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-863" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑂</span><span class="mo" id="MathJax-Span-864" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-865" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝐷</span><span class="mo" id="MathJax-Span-866" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-867" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi><mo>=</mo><mi>O</mi><mo>+</mo><mi>D</mi><mo>∗</mo><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-90">X=O+D*t</script>。</li>
<li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-868" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-869"><span class="mi" id="MathJax-Span-870" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-91">X</script> 点在球面上，即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-871" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-872"><span class="mi" id="MathJax-Span-873" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-92">X</script> 与球心 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-874" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-875"><span class="mi" id="MathJax-Span-876" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-93">P</script> 的距离等于球的半径 。即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-877" style="width: 6.352em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.012em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1005.01em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-878"><span class="texatom" id="MathJax-Span-879"><span class="mrow" id="MathJax-Span-880"><span class="mo" id="MathJax-Span-881" style="font-family: STIXVariants;">|</span></span></span><span class="mi" id="MathJax-Span-882" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-883" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-884" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="texatom" id="MathJax-Span-885"><span class="mrow" id="MathJax-Span-886"><span class="mo" id="MathJax-Span-887" style="font-family: STIXVariants;">|</span></span></span><span class="mo" id="MathJax-Span-888" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-889" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑟</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>X</mi><mo>−</mo><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mo>=</mo><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-94">|X-P|=r</script>，也就是 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-890" style="width: 7.443em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.905em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em, 1005.9em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-891"><span class="mo" id="MathJax-Span-892" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-893" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-894" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-895" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="msubsup" id="MathJax-Span-896"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-897" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.35em;"><span class="mn" id="MathJax-Span-898" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-899" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-900" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-901" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.399em;"><span class="mn" id="MathJax-Span-902" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-95">(X-P)^2=r^2</script>。</li>
</ol>
<p>将 (1) 中关于 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-903" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-904"><span class="mi" id="MathJax-Span-905" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-96">X</script> 的表达式代入 (2)，得到：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-906" style="width: 11.51em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 9.129em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1009.13em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-907"><span class="mo" id="MathJax-Span-908" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-909" style="font-family: STIXGeneral-Italic;">𝑂</span><span class="mo" id="MathJax-Span-910" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-911" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝐷</span><span class="mo" id="MathJax-Span-912" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-913" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑡</span><span class="mo" id="MathJax-Span-914" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-915" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="msubsup" id="MathJax-Span-916"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-917" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-918" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-919" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-920" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-921" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.399em;"><span class="mn" id="MathJax-Span-922" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mi>O</mi><mo>+</mo><mi>D</mi><mo>∗</mo><mi>t</mi><mo>−</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-97">\begin{equation}(O+D*t-P)^2=r^2\end{equation}</script></p>
<p>展开得到：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;O&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-923" style="width: 24.159em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 19.149em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1019.15em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-924"><span class="msubsup" id="MathJax-Span-925"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-926" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.796em;"><span class="mn" id="MathJax-Span-927" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-928" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-929" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑡</span><span class="mo" id="MathJax-Span-930" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-931" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">2</span><span class="mo" id="MathJax-Span-932" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-933" style="font-family: STIXGeneral-Italic;">𝑂</span><span class="mo" id="MathJax-Span-934" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-935" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-936" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-937" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-938" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝐷</span><span class="mo" id="MathJax-Span-939" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-940" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑡</span><span class="mo" id="MathJax-Span-941" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mo" id="MathJax-Span-942" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-943" style="font-family: STIXGeneral-Italic;">𝑂</span><span class="mo" id="MathJax-Span-944" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-945" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="msubsup" id="MathJax-Span-946"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-947" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-948" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-949" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-950" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-951" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.399em;"><span class="mn" id="MathJax-Span-952" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-953" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-954" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>D</mi><mn>2</mn></msup><mo>∗</mo><mi>t</mi><mo>+</mo><mn>2</mn><mo stretchy="false">(</mo><mi>O</mi><mo>−</mo><mi>P</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>D</mi><mo>∗</mo><mi>t</mi><mo>+</mo><mo stretchy="false">(</mo><mi>O</mi><mo>−</mo><mi>P</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-98">\begin{equation}D^2*t+2(O-P)\cdot D*t+(O-P)^2-r^2=0\end{equation}</script></p>
<p>这已经是一个一元二次方程，自变量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-955" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.788em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-956"><span class="mi" id="MathJax-Span-957" style="font-family: STIXGeneral-Italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-99">t</script> 是未知的。所有矢量经过平方或点积后都成为了标量，可以直接根据一元二次方程 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-958" style="width: 8.931em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.096em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em, 1007.1em, 2.681em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-959"><span class="mi" id="MathJax-Span-960" style="font-family: STIXGeneral-Italic;">𝑎</span><span class="msubsup" id="MathJax-Span-961"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-962" style="font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.548em;"><span class="mn" id="MathJax-Span-963" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-964" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-965" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑏</span><span class="mi" id="MathJax-Span-966" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-967" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-968" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑐</span><span class="mo" id="MathJax-Span-969" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-970" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-100">ax^2+bx+c=0</script> 的求根公式：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-971" style="width: 11.262em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 8.931em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.647em, 1008.93em, 3.326em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-972"><span class="mi" id="MathJax-Span-973" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-974" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-975" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 6.897em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(2.929em, 1006.8em, 4.467em, -999.998em); top: -4.759em; left: 50%; margin-left: -3.371em;"><span class="mrow" id="MathJax-Span-976"><span class="mo" id="MathJax-Span-977" style="font-family: STIXGeneral-Regular;">−</span><span class="mi" id="MathJax-Span-978" style="font-family: STIXGeneral-Italic;">𝑏</span><span class="mo" id="MathJax-Span-979" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">±</span><span class="msqrt" id="MathJax-Span-980" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1003.48em, 4.318em, -999.998em); top: -4.015em; left: 0.945em;"><span class="mrow" id="MathJax-Span-981"><span class="msubsup" id="MathJax-Span-982"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-983" style="font-family: STIXGeneral-Italic;">𝑏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="mn" id="MathJax-Span-984" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-985" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mn" id="MathJax-Span-986" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">4</span><span class="mi" id="MathJax-Span-987" style="font-family: STIXGeneral-Italic;">𝑎</span><span class="mi" id="MathJax-Span-988" style="font-family: STIXGeneral-Italic;">𝑐</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1003.52em, 3.375em, -999.998em); top: -4.115em; left: 0.945em;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 3.028em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.135em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.582em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.879em, 1000.95em, 4.417em, -999.998em); top: -3.966em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1001em, 4.169em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.494em;"><span class="mrow" id="MathJax-Span-989"><span class="mn" id="MathJax-Span-990" style="font-family: STIXGeneral-Regular;">2</span><span class="mi" id="MathJax-Span-991" style="font-family: STIXGeneral-Italic;">𝑎</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1006.9em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.897em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 3.128em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>x</mi><mo>=</mo><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-101">\begin{equation}x=\frac{-b\pm \sqrt{b^2-4ac}}{2 a}\end{equation}</script></p>
<p>计算出根 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-992" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.788em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-993"><span class="mi" id="MathJax-Span-994" style="font-family: STIXGeneral-Italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-102">t</script>。</p>
<ol>
<li>一元二次方程可能没有实根的，此时射线与球体不相交。这对应着代码中 <code>det&lt;0</code> 的情况，直接返回 0。</li>
<li>一元二次方程可能有两个实根，此时射线（所在的直线）与球体有两个交点。我们需要取的是<strong>最小的正根</strong>。如果另一个根 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-995" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.292em, 1000.65em, 2.334em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-996"><span class="msup" id="MathJax-Span-997"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.326em, 1000.3em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-998" style="font-family: STIXGeneral-Italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.3em;"><span class="mo" id="MathJax-Span-999" style="font-size: 70.7%; font-family: STIXVariants;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>t</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-103">t'</script>（对应交点为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1000" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.292em, 1001.19em, 2.334em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1001"><span class="msup" id="MathJax-Span-1002"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.8em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1003" style="font-family: STIXGeneral-Italic;">𝑋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.846em;"><span class="mo" id="MathJax-Span-1004" style="font-size: 70.7%; font-family: STIXVariants;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>X</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-104">X'</script>）大于 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1005" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.788em, 1000.25em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1006"><span class="mi" id="MathJax-Span-1007" style="font-family: STIXGeneral-Italic;">𝑡</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-105">t</script>，表明是左图的情况；如果 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1008" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.292em, 1000.65em, 2.334em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1009"><span class="msup" id="MathJax-Span-1010"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.326em, 1000.3em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1011" style="font-family: STIXGeneral-Italic;">𝑡</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.3em;"><span class="mo" id="MathJax-Span-1012" style="font-size: 70.7%; font-family: STIXVariants;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>t</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-106">t'</script> 小于等于 0，表明是右图的情况，这条光线是在介质内的折射光线。</li>
</ol>
<h3 id="使用球体表示场景">使用球体表示场景</h3>
<p>代码定义了一个 <code>spheres</code> 数组来表达整个场景，每一个球体分别是：</p>
<ol>
<li>左侧墙体，红色；墙体的半径都很大，观者感知不到曲率；墙体的反射类型都是散射，但是颜色有所不同。</li>
<li>右侧墙体，蓝色。</li>
<li>后面墙体，灰色。</li>
<li>前面墙体，黑色。</li>
<li>底部墙体，灰色。</li>
<li>顶部墙体，灰色。</li>
<li>左侧球体，镜面材质。</li>
<li>右侧球体，透明玻璃材质，光线可能折射进入玻璃中继续传播。</li>
<li>顶部的光源，发射出强度为 12 的白光。</li>
</ol>
<pre><code class="language-c">Sphere spheres[] = { //Scene: radius, position, emission, color, material
  Sphere(1e5, Vec( 1e5+1,40.8,81.6), Vec(),Vec(.75,.25,.25),DIFF),//Left
  Sphere(1e5, Vec(-1e5+99,40.8,81.6),Vec(),Vec(.25,.25,.75),DIFF),//Rght
  Sphere(1e5, Vec(50,40.8, 1e5),     Vec(),Vec(.75,.75,.75),DIFF),//Back
  Sphere(1e5, Vec(50,40.8,-1e5+170), Vec(),Vec(),           DIFF),//Frnt
  Sphere(1e5, Vec(50, 1e5, 81.6),    Vec(),Vec(.75,.75,.75),DIFF),//Botm
  Sphere(1e5, Vec(50,-1e5+81.6,81.6),Vec(),Vec(.75,.75,.75),DIFF),//Top
  Sphere(16.5,Vec(27,16.5,47),       Vec(),Vec(1,1,1)*.999, SPEC),//Mirr
  Sphere(16.5,Vec(73,16.5,78),       Vec(),Vec(1,1,1)*.999, REFR),//Glas
  Sphere(600, Vec(50,681.6-.27,81.6),Vec(12,12,12),  Vec(), DIFF) //Lite
};</code></pre>
<p>可以看出，坐标轴的原点位于盒子的左面、后面和底面的交点附近。宽度 100 左右，高度 80 左右，深度 170 左右。</p>
<h2 id="准备渲染">准备渲染</h2>
<p>在真正开始渲染之前，还需要做一些准备工作。</p>
<h3 id="确定相机和输出图像">确定相机和输出图像</h3>
<p>先跳过 <code>clamp</code>，<code>toInt</code>，<code>radiance</code> 这几个函数，直接来看 <code>main</code> 函数。</p>
<pre><code class="language-cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span>{
  <span class="hljs-keyword">int</span> w=<span class="hljs-number">1024</span>, h=<span class="hljs-number">768</span>, samps = argc==<span class="hljs-number">2</span> ? atoi(argv[<span class="hljs-number">1</span>])/<span class="hljs-number">4</span> : <span class="hljs-number">30</span>;
  <span class="hljs-function">Ray <span class="hljs-title">cam</span><span class="hljs-params">(Vec(<span class="hljs-number">50</span>,<span class="hljs-number">52</span>,<span class="hljs-number">295.6</span>), Vec(<span class="hljs-number">0</span>,<span class="hljs-number">-0.042612</span>,<span class="hljs-number">-1</span>).norm())</span></span>; <span class="hljs-comment">// cam pos, dir</span>
  Vec cx=Vec(w*<span class="hljs-number">.5135</span>/h), cy=(cx%cam.d).norm()*<span class="hljs-number">.5135</span>, r, *c=<span class="hljs-keyword">new</span> Vec[w*h];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y=<span class="hljs-number">0</span>; y&lt;h; y++){                       <span class="hljs-comment">// Loop over image rows</span>
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">"\rRendering (%d spp) %5.2f%%"</span>,samps*<span class="hljs-number">4</span>,<span class="hljs-number">100.</span>*y/(h<span class="hljs-number">-1</span>));
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">unsigned</span> short x=<span class="hljs-number">0</span>, Xi[<span class="hljs-number">3</span>]={<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,(<span class="hljs-keyword">unsigned</span> short)(y*y*y)}; x&lt;w; x++)
      <span class="hljs-comment">// ... 暂时先省略</span>
  }
  FILE *f = fopen(<span class="hljs-string">"image.ppm"</span>, <span class="hljs-string">"w"</span>);         <span class="hljs-comment">// Write image to PPM file.</span>
  <span class="hljs-built_in">fprintf</span>(f, <span class="hljs-string">"P3\n%d %d\n%d\n"</span>, w, h, <span class="hljs-number">255</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;w*h; i++)
    <span class="hljs-built_in">fprintf</span>(f,<span class="hljs-string">"%d %d %d "</span>, toInt(c[i].x), toInt(c[i].y), toInt(c[i].z));
}</code></pre>
<p>首先，定义需要渲染图像的宽度（1024），高度（768），对每个像素的采样次数（命令行参数传入，或 120 次）。注意，变量 <code>samps</code> 的值是采样次数的 1/4，在这个例子中，最终渲染在图像上的每一个像素，又会拆分成 4 个子像素进行追踪和采样，而 <code>samps</code> 的值是子像素的采样次数。</p>
<p>然后，使用射线类的变量 <code>cam</code> 来表示相机，射线的原点 <code>cam.o</code> 即是相机的位置，而射线的方向 <code>cam.d</code> 是相机朝向的方向。由于相机本身的位置只是一个点，所以需要把渲染出的图像视为在屏幕前方（亦或是后方，参考一下眼球和相机的构造）不远处的一块矩形幕布，抵达相机的光线穿透幕布时会在与幕布的交点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1013" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1014"><span class="mi" id="MathJax-Span-1015" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-107">P</script> 处留下颜色，这样就在幕布上投影了。只要幕布的分辨率和宽高比不变，其距离相机的远近与最终结果是无关的，所以程序直接设定幕布与相机的距离是 1，设定幕布本身的高度为 0.5135（配合像素尺寸的宽高比，其实这里已经暗含了相机的水平和垂直视场角的信息）。然后，求取长度等于幕布真实宽度 <code>0.5135*w/h</code> 的水平矢量 <code>cx</code>（平行于 X 轴），求取长度等于幕布真实高度 <code>0.5135</code> 的垂直矢量 <code>cy</code>（通过 <code>cx</code> 与 <code>cam.d</code> 叉乘而来）。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1QZQydEKF3KVjSZFEXXXExFXa-237-277.png" alt=""></p>
<p>再接着，生成长度为 <code>w*h</code> 的 <code>Vec</code> 类型数组 <code>c</code> 备用。这个数组的作用是存储渲染的结果。</p>
<p>最后，遍历宽度和高度，对每一个像素进行渲染，并将渲染得到值写入到数组 <code>c</code> 中，并将其输出为 PPM 格式的图片，以便打开查看渲染效果。</p>
<blockquote>
<p>PPM 是一种基于文本的图片格式，能够帮助你避免考虑图片文件编码问题，轻易地按像素输出图片。比如以下文本内容就是一张 4x4 的图片。</p>
<pre><code>P3
# feep.ppm
4 4
15
 0  0  0    0  0  0    0  0  0   15  0 15
 0  0  0    0 15  7    0  0  0    0  0  0
 0  0  0    0  0  0    0 15  7    0  0  0
15  0 15    0  0  0    0  0  0    0  0  0</code></pre><p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB17WH3dv1H3KVjSZFBXXbSMXXa-120-120.png" alt=""></p>
</blockquote>
<p>总结一下各个变量的含义：</p>
<ol>
<li><code>w</code> 和 <code>h</code>：宽度和高度像素数。</li>
<li><code>samps</code>：每个像素采样次数的 1/4。</li>
<li><code>cam</code>：相机描述。</li>
<li><code>cx</code> 和 <code>cy</code>：长度与幕布真实尺寸相同的水平、垂直矢量。</li>
<li><code>c</code>：按像素存储渲染结果的数组。</li>
</ol>
<h3 id="子像素采样">子像素采样</h3>
<p>接下来，我们看一下如何计算每个像素的值的（即之前省略的部分）。对每一个像素，都将其拆分为 2x2 一共 4 个子像素。一个当然的想法是，以子像素的中心点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1016" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1017"><span class="msubsup" id="MathJax-Span-1018"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1019" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1020" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-108">P_s</script> 作为射线的出发点开始追踪，但是由于每个子像素都会进行 <code>samps</code> 次光追取均值，所以这里就引入了一次随机过程：以子像素的中心点，在一个像素大小的范围内进行一次随机采样，并以采样到的点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1021" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1022"><span class="msubsup" id="MathJax-Span-1023"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1024" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1025" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-109">P_i</script> 为射线的出发点，进行一次光追。对每个子像素完成 <code>samps</code> 次光追，依次以 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1026" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1027"><span class="msubsup" id="MathJax-Span-1028"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1029" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-1030" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-110">P_1</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1031" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.04em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1032"><span class="msubsup" id="MathJax-Span-1033"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1034" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-1035" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-111">P_2</script> ……为出发点，最后求均值。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1QR3EdBCw3KVjSZR0XXbcUpXa-214-214.png" alt=""></p>
<p>而且，为了使渲染的质量更高一些（达到相同渲染质量所需的采样次数更小一些），这里对随机过程进行了优化：对随机数进行了一次 <a href="https://computergraphics.stackexchange.com/questions/3868/why-use-a-tent-filter-in-path-tracing">tent 滤波</a>。此滤波函数将 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1036" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1037"><span class="mi" id="MathJax-Span-1038" style="font-family: STIXGeneral-Italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-112">x</script> 从 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1039" style="width: 2.681em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.135em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.04em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1040"><span class="mo" id="MathJax-Span-1041" style="font-family: STIXGeneral-Regular;">[</span><span class="mn" id="MathJax-Span-1042" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-1043" style="font-family: STIXGeneral-Regular;">,</span><span class="mn" id="MathJax-Span-1044" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">2</span><span class="mo" id="MathJax-Span-1045" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>2</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-113">[0,2]</script> 区间映射到了 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1046" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.73em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1047"><span class="mo" id="MathJax-Span-1048" style="font-family: STIXGeneral-Regular;">[</span><span class="mo" id="MathJax-Span-1049" style="font-family: STIXGeneral-Regular;">−</span><span class="mn" id="MathJax-Span-1050" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1051" style="font-family: STIXGeneral-Regular;">,</span><span class="mn" id="MathJax-Span-1052" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">1</span><span class="mo" id="MathJax-Span-1053" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-114">[-1, 1]</script>，当 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1054" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1055"><span class="mi" id="MathJax-Span-1056" style="font-family: STIXGeneral-Italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-115">x</script> 为随机的值时，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1057" style="width: 2.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.838em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.79em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1058"><span class="mi" id="MathJax-Span-1059" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1060" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1061" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-1062" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-116">f(x)</script> 的分布更向中点值 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1063" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1064"><span class="mn" id="MathJax-Span-1065" style="font-family: STIXGeneral-Regular;">0</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-117">0</script> 集中（从图中可以看出）。</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msqrt&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msqrt&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2190;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msqrt&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2190;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo fence=&quot;true&quot; stretchy=&quot;true&quot; symmetric=&quot;true&quot;&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1066" style="width: 16.471em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 13.048em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(2.284em, 1013.05em, 5.31em, -999.998em); top: -4.065em; left: 0em;"><span class="mrow" id="MathJax-Span-1067"><span class="mi" id="MathJax-Span-1068" style="font-family: STIXGeneral-Italic;">𝑓<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1069" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1070" style="font-family: STIXGeneral-Italic;">𝑥</span><span class="mo" id="MathJax-Span-1071" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1072" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mrow" id="MathJax-Span-1073" style="padding-left: 0.3em;"><span class="mo" id="MathJax-Span-1074" style="vertical-align: -0.593em;"><span style="font-family: STIXSizeThreeSym;">{</span></span><span class="mtable" id="MathJax-Span-1075"><span style="display: inline-block; position: relative; width: 8.733em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.334em, 1008.63em, 5.26em, -999.998em); top: -4.015em; left: 0em;"><span style="display: inline-block; position: relative; width: 8.733em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1006.75em, 4.417em, -999.998em); top: -4.809em; left: 50%; margin-left: -3.42em;"><span class="mtd" id="MathJax-Span-1076"><span class="mrow" id="MathJax-Span-1077"><span class="msqrt" id="MathJax-Span-1078"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0.747em;"><span class="mrow" id="MathJax-Span-1079"><span class="mi" id="MathJax-Span-1080" style="font-family: STIXGeneral-Italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1000.6em, 3.375em, -999.998em); top: -3.867em; left: 0.747em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0.102em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1000.75em, 4.169em, -999.998em); top: -3.767em; left: 0em;"><span style="font-family: STIXVariants;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1081" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mn" id="MathJax-Span-1082" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span><span class="mo" id="MathJax-Span-1083" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">←</span><span class="mi" id="MathJax-Span-1084" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑥</span><span class="mo" id="MathJax-Span-1085" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&lt;</span><span class="mn" id="MathJax-Span-1086" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.979em, 1008.63em, 4.516em, -999.998em); top: -3.222em; left: 50%; margin-left: -4.363em;"><span class="mtd" id="MathJax-Span-1087"><span class="mrow" id="MathJax-Span-1088"><span class="mn" id="MathJax-Span-1089" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1090" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msqrt" id="MathJax-Span-1091" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 3.177em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1002.18em, 4.318em, -999.998em); top: -4.015em; left: 0.945em;"><span class="mrow" id="MathJax-Span-1092"><span class="mn" id="MathJax-Span-1093" style="font-family: STIXGeneral-Regular;">2</span><span class="mo" id="MathJax-Span-1094" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1095" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1002.28em, 3.375em, -999.998em); top: -4.065em; left: 0.945em;"><span style="display: inline-block; position: relative; width: 2.284em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.879em, 1000.95em, 4.417em, -999.998em); top: -3.916em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1096" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">←</span><span class="mi" id="MathJax-Span-1097" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑥</span><span class="mo" id="MathJax-Span-1098" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&gt;</span><span class="mn" id="MathJax-Span-1099" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1100"></span></span></span><span style="display: inline-block; width: 0px; height: 4.07em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.434em; border-left: 0px solid; width: 0px; height: 3.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo>{</mo><mtable rowspacing="4pt" columnspacing="1em"><mtr><mtd><msqrt><mi>x</mi></msqrt><mo>−</mo><mn>1</mn><mo stretchy="false">←</mo><mi>x</mi><mo>&lt;</mo><mn>1</mn></mtd></mtr><mtr><mtd><mn>1</mn><mo>−</mo><msqrt><mn>2</mn><mo>−</mo><mi>x</mi></msqrt><mo stretchy="false">←</mo><mi>x</mi><mo>&gt;</mo><mn>1</mn></mtd></mtr></mtable><mo fence="true" stretchy="true" symmetric="true"></mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-118">\begin{equation}f(x) = \left \{ \begin{matrix} \sqrt{x} -1 \leftarrow x<1 \\ 1-\sqrt{2-x} \leftarrow x>1 \end{matrix} \right. \end{equation}</script></p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB18tZDdxiH3KVjSZPfXXXBiVXa-242-266.png" alt=""></p>
<p>然后，拿到经过滤波后的随机数 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1101" style="width: 1.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.04em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1102"><span class="mi" id="MathJax-Span-1103" style="font-family: STIXGeneral-Italic;">𝑑</span><span class="mi" id="MathJax-Span-1104" style="font-family: STIXGeneral-Italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-119">dx</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1105" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.04em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1106"><span class="mi" id="MathJax-Span-1107" style="font-family: STIXGeneral-Italic;">𝑑</span><span class="mi" id="MathJax-Span-1108" style="font-family: STIXGeneral-Italic;">𝑦</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-120">dy</script>，计算 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1109" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1110"><span class="msubsup" id="MathJax-Span-1111"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1112" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1113" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-121">P_i</script> 在整个画布中的归一化坐标（假设成为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1114" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.95em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1115"><span class="msubsup" id="MathJax-Span-1116"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1117" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1118" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑥</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>n</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-122">n_x</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1119" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.95em, 2.631em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1120"><span class="msubsup" id="MathJax-Span-1121"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1122" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1123" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑦</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>n</mi><mi>y</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-123">n_y</script>，如 <code>nx=(sx+0.5+dx)/2+x)/w-0.5</code>），再乘以之前求得的画布真实尺寸矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1124" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1125"><span class="mi" id="MathJax-Span-1126" style="font-family: STIXGeneral-Italic;">𝑐</span><span class="mi" id="MathJax-Span-1127" style="font-family: STIXGeneral-Italic;">𝑥</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-124">cx</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1128" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1000.89em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1129"><span class="mi" id="MathJax-Span-1130" style="font-family: STIXGeneral-Italic;">𝑐</span><span class="mi" id="MathJax-Span-1131" style="font-family: STIXGeneral-Italic;">𝑦</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-125">cy</script>，加上相机本身的方向矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1132" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.55em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1133"><span class="mi" id="MathJax-Span-1134" style="font-family: STIXGeneral-Italic;">𝑑</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-126">d</script>，就得到了最终从相机原点射向 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;P&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1135" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1136"><span class="msubsup" id="MathJax-Span-1137"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1138" style="font-family: STIXGeneral-Italic;">𝑃<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1139" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑖</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>P</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-127">P_i</script> 的矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1140" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1141"><span class="mi" id="MathJax-Span-1142" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-128">D</script>，即代码中的 <code>d</code>。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1uz3Hdq5s3KVjSZFNXXcD3FXa-231-277.png" alt=""></p>
<pre><code class="language-cpp"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sy=<span class="hljs-number">0</span>, i=(h-y<span class="hljs-number">-1</span>)*w+x; sy&lt;<span class="hljs-number">2</span>; sy++)     <span class="hljs-comment">// 2x2 subpixel rows</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sx=<span class="hljs-number">0</span>; sx&lt;<span class="hljs-number">2</span>; sx++, r=Vec()){        <span class="hljs-comment">// 2x2 subpixel cols</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s=<span class="hljs-number">0</span>; s&lt;samps; s++){
            <span class="hljs-keyword">double</span> r1=<span class="hljs-number">2</span>*erand48(Xi), dx=r1&lt;<span class="hljs-number">1</span> ? <span class="hljs-built_in">sqrt</span>(r1)<span class="hljs-number">-1</span>: <span class="hljs-number">1</span>-<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>-r1);
            <span class="hljs-keyword">double</span> r2=<span class="hljs-number">2</span>*erand48(Xi), dy=r2&lt;<span class="hljs-number">1</span> ? <span class="hljs-built_in">sqrt</span>(r2)<span class="hljs-number">-1</span>: <span class="hljs-number">1</span>-<span class="hljs-built_in">sqrt</span>(<span class="hljs-number">2</span>-r2);
            Vec d = cx*( ( (sx+<span class="hljs-number">.5</span> + dx)/<span class="hljs-number">2</span> + x)/w - <span class="hljs-number">.5</span>) +
            cy*( ( (sy+<span class="hljs-number">.5</span> + dy)/<span class="hljs-number">2</span> + y)/h - <span class="hljs-number">.5</span>) + cam.d;
            r = r + radiance(Ray(cam.o+d*<span class="hljs-number">140</span>,d.norm()),<span class="hljs-number">0</span>,Xi)*(<span class="hljs-number">1.</span>/samps);
        } <span class="hljs-comment">// Camera rays are pushed ^^^^^ forward to start in interior</span>
        c[i] = c[i] + Vec(clamp(r.x),clamp(r.y),clamp(r.z))*<span class="hljs-number">.25</span>;
    }</code></pre>
<p>最后，调用 <code>radiance</code>，沿着穿过此子像素的射线，在 140 倍远（让光追的开始点进到盒子里面，而不会直接被朝前的表面挡掉）的地方开始进行光线追踪算法。进行 <code>samps</code> 次，取均值，再基于 4 个子像素再取一次均值，就得到了这个像素的颜色。</p>
<blockquote>
<p>erand48() 函数是 C 标准库提供的随机函数。传入长度为 3 的数组作为随机种子，返回 [0, 1] 区间的双精度浮点数，同时改写传入的随机种子，便于下一次调用 erand() 时传入（以获取一个不同的结果）。</p>
</blockquote>
<p>总结一下各个变量的含义：</p>
<ul>
<li><code>i</code>：为当前像素在 <code>c</code> 中的索引。</li>
<li><code>r</code>：通过光追计算出的子像素的颜色。</li>
<li><code>sx</code> 和 <code>sy</code>：子像素索引，为 0 或 1。</li>
<li><code>r1</code> 和 <code>r2</code>：滤波用自变量，在 [0, 2] 区间随机取得。</li>
<li><code>dx</code> 和 <code>dy</code>：滤波后的随机自变量，分布在 [-1, 1] 区间内。</li>
<li><code>d</code> ：从相机原点指向子像素位置的矢量。</li>
</ul>
<h2 id="光线追踪">光线追踪</h2>
<p>讲了这么多，终于到正餐了。函数 <code>radiance()</code> 即进行了一次光线追踪。</p>
<pre><code class="language-c">Vec radiance(const Ray &amp;r, int depth, unsigned short *Xi){
    double t;                               // distance to intersection
    int id=0;                               // id of intersected object
    if (!intersect(r, t, id)) return Vec(); // if miss, return black
    const Sphere &amp;obj = spheres[id];        // the hit object
    Vec x=r.o+r.d*t, n=(x-obj.p).norm(), nl=n.dot(r.d)&lt;0?n:n*-1, f=obj.c;
    double p = f.x&gt;f.y &amp;&amp; f.x&gt;f.z ? f.x : f.y&gt;f.z ? f.y : f.z; // max refl
    if (++depth&gt;5) if (erand48(Xi)&lt;p) f=f*(1/p); else return obj.e; //R.R.
    if (obj.refl == DIFF){                  // Ideal DIFFUSE reflection
      // ...
    } else if (obj.refl == SPEC)            // Ideal SPECULAR reflection
      // ...
    // ...                                   // Ideal dielectric REFRACTION
}</code></pre>
<p>函数 <code>radiance()</code> 接收三个参数，射线 <code>r</code>，深度 <code>depth</code> 和随机种子 <code>Xi</code>。此函数是一个递归函数，在计算射线颜色时候，遇到反射或折射，会计算出下一次反射或折射的射线，然后递归调用自己求算下一次射线的颜色。深度 <code>depth</code> 标记了反射/折射的次数。</p>
<p>下面看 <code>radiance()</code> 函数的逻辑：</p>
<h3 id="求取交点和递归结束条件">求取交点和递归结束条件</h3>
<p>首先，对场景中的所有球体对象，尝试求取射线与之交点。函数 <code>intersect()</code> 负责做这件事：遍历 <code>spheres</code> 数组，依次调用 <code>sphere</code> 对象上的 <code>intersect()</code> 方法，并保留最小的正值 <code>t</code> 和对应球体在 <code>spheres</code> 数组中的索引 <code>i</code>。</p>
<pre><code class="language-c">inline bool intersect(const Ray &amp;r, double &amp;t, int &amp;id){
    double n=sizeof(spheres) /sizeof(Sphere), d, inf=t=1e20;
    for(int i=int(n);i--;) if((d=spheres[i].intersect(r))&amp;&amp;d&lt;t){t=d;id=i;}
    return t&lt;inf;
}</code></pre>
<p>如果没有任何对象与之相交，直接返回黑色（递归的结束条件 1）。</p>
<p>如果检测到有球体与射线相交，首先检查当前深度是否大于了 5（之前已经经过了 5 次反射或折射），如果是，那么遵循一个概率来随机地决定采取以下哪一种方案：</p>
<ol>
<li>放弃反射光的贡献，直接返回物体的出射光——虽然大部分时候是 0（递归的结束条件 2）。</li>
<li>继续追踪光线。</li>
</ol>
<p>这个概率就是当前物体表面的颜色 RGB 分量中最大的那个分量，归一化后的值。换言之，物体越暗（的颜色值越低），越容易被筛选到第 1 种方案（因为物体暗，环境光反射贡献的值也会小），而物体越亮，越容易被筛选到第二种方案。值得注意的是，当选择第二种方案时，需要把物体的颜色按照概率调高一些 <code>f=f*(1/p)</code>，这是因为那些运气不够好，被筛选到 1 方案光线，其反射分量完全地消失了，这会导致最终计算出的颜色的期望（也就是说，即使采样无穷次）与真实值产生偏差。在运气好的 2 方案中调整颜色，可以消除这个偏差。</p>
<blockquote>
<p>按照概率进行随机选择是无处不在的，只要采样的次数足够多，那么遵照概率选择计算得到的均值就能够逼近真实值。</p>
</blockquote>
<p>接着，如果深度小于等于 5，那么不管物体的颜色值如何，都会正常地递归地进行光线追踪。在此之前，还需要预先求取一些变量的值，比如法线 <code>nl</code> 等，便于后续使用。</p>
<p>总结一下各变量的意义：</p>
<ul>
<li><code>t</code>：交点距离相机原点的距离。</li>
<li><code>id</code>：相交的球体在 <code>spheres</code> 数组中的索引。</li>
<li><code>obj</code>：相交的球体 <code>Sphere</code> 对象。</li>
<li><code>x</code>：交点的位置。</li>
<li><code>n</code>：球体在交点处的归一化的法线（从球心射向表面）。</li>
<li><code>nl</code>：与反射/折射上下文契合的归一化的法线：如果射线在球体外部，<code>nl</code> 与 <code>n</code> 相同；如果射线在球体内部（折射），<code>nl</code> 与 <code>n</code> 相反。</li>
</ul>
<h3 id="散射（漫反射）">散射（漫反射）</h3>
<p>追踪光线，当代表光线的射线与球体相交时，根据球体表面的特性，进行不同的操作（代码中省略的部分）。</p>
<p>如果物体表面是漫反射，将随机选取一个角度取归一化的反射光线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1143" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1144"><span class="mi" id="MathJax-Span-1145" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-129">D</script>：</p>
<ol>
<li>确定互相正交的三个归一化矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1146" style="width: 0.945em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1147"><span class="mi" id="MathJax-Span-1148" style="font-family: STIXGeneral-Italic;">𝑈<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math></span></span><script type="math/tex" id="MathJax-Element-130">U</script>，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1149" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1150"><span class="mi" id="MathJax-Span-1151" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-131">V</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1152" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.14em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1153"><span class="mi" id="MathJax-Span-1154" style="font-family: STIXGeneral-Italic;">𝑊<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi></math></span></span><script type="math/tex" id="MathJax-Element-132">W</script>，其中 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1155" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.14em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1156"><span class="mi" id="MathJax-Span-1157" style="font-family: STIXGeneral-Italic;">𝑊<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi></math></span></span><script type="math/tex" id="MathJax-Element-133">W</script> 为反射面的法线。</li>
<li>在区间 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1158" style="width: 2.681em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.135em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.04em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1159"><span class="mo" id="MathJax-Span-1160" style="font-family: STIXGeneral-Regular;">[</span><span class="mn" id="MathJax-Span-1161" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-1162" style="font-family: STIXGeneral-Regular;">,</span><span class="mn" id="MathJax-Span-1163" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">1</span><span class="mo" id="MathJax-Span-1164" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-134">[0, 1]</script> 中随机确定一个值 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1165" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.85em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1166"><span class="msubsup" id="MathJax-Span-1167"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1168" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1169" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>r</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-135">r_2</script>，并使 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1170" style="width: 4.566em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.624em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.846em, 1003.62em, 2.979em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1171"><span class="msqrt" id="MathJax-Span-1172"><span style="display: inline-block; position: relative; width: 3.624em; height: 0px;"><span style="position: absolute; clip: rect(3.028em, 1002.53em, 4.467em, -999.998em); top: -4.015em; left: 1.044em;"><span class="mrow" id="MathJax-Span-1173"><span class="mn" id="MathJax-Span-1174" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1175" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1176" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1177" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.399em;"><span class="mn" id="MathJax-Span-1178" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -3.718em; left: 0.399em;"><span class="mn" id="MathJax-Span-1179" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1002.53em, 3.375em, -999.998em); top: -4.363em; left: 1.044em;"><span style="display: inline-block; position: relative; width: 2.532em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 2.036em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.796em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.243em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.639em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.334em, 1001.09em, 4.467em, -999.998em); top: -3.668em; left: 0em;"><span style="font-family: STIXSizeOneSym;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.872em; border-left: 0px solid; width: 0px; height: 2.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><mn>1</mn><mo>−</mo><msubsup><mi>r</mi><mn>2</mn><mn>2</mn></msubsup></msqrt></math></span></span><script type="math/tex" id="MathJax-Element-136">\sqrt{1-r_2^2}</script> 作为反射光线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1180" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1181"><span class="mi" id="MathJax-Span-1182" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-137">D</script> 在法线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1183" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.14em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1184"><span class="mi" id="MathJax-Span-1185" style="font-family: STIXGeneral-Italic;">𝑊<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>W</mi></math></span></span><script type="math/tex" id="MathJax-Element-138">W</script> 方向上投影的长度，使 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msqrt&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1186" style="width: 2.036em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.59em, 2.631em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1187"><span class="msqrt" id="MathJax-Span-1188"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.85em, 4.318em, -999.998em); top: -4.015em; left: 0.747em;"><span class="mrow" id="MathJax-Span-1189"><span class="msubsup" id="MathJax-Span-1190"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1191" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1192" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1000.85em, 3.375em, -999.998em); top: -3.817em; left: 0.747em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0.35em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1000.75em, 4.169em, -999.998em); top: -3.718em; left: 0em;"><span style="font-family: STIXVariants;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msqrt><msub><mi>r</mi><mn>2</mn></msub></msqrt></math></span></span><script type="math/tex" id="MathJax-Element-139">\sqrt{r_2}</script> 也就是 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1193" style="width: 1.639em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.887em, 1001.24em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1194"><span class="msubsup" id="MathJax-Span-1195"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1196" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1197" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1198" style="font-family: STIXGeneral-Italic;">𝑠</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>r</mi><mn>2</mn></msub><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-140">r_2 s</script> 成为反射光线在表面上投影的长度。</li>
<li>在区间 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1199" style="width: 3.375em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.58em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1200"><span class="mo" id="MathJax-Span-1201" style="font-family: STIXGeneral-Regular;">[</span><span class="mn" id="MathJax-Span-1202" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-1203" style="font-family: STIXGeneral-Regular;">,</span><span class="mn" id="MathJax-Span-1204" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">2</span><span class="mi" id="MathJax-Span-1205" style="font-family: STIXGeneral-Italic;">𝜋<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1206" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>2</mn><mi>π</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-141">[0, 2\pi]</script> 中随机确定一个角度值 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1207" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.8em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1208"><span class="mi" id="MathJax-Span-1209" style="font-family: STIXGeneral-Italic;">𝑟</span><span class="mn" id="MathJax-Span-1210" style="font-family: STIXGeneral-Regular;">1</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-142">r1</script>，使之成为反射光点 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1211" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1212"><span class="mi" id="MathJax-Span-1213" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-143">D</script> 在反射表面（即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1214" style="width: 1.937em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1001.54em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1215"><span class="mi" id="MathJax-Span-1216" style="font-family: STIXGeneral-Italic;">𝑈<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mi" id="MathJax-Span-1217" style="font-family: STIXGeneral-Italic;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-144">UV</script> 平面）的投影与 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1218" style="width: 0.945em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1219"><span class="mi" id="MathJax-Span-1220" style="font-family: STIXGeneral-Italic;">𝑈<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi></math></span></span><script type="math/tex" id="MathJax-Element-145">U</script> 轴的交角。</li>
<li>极坐标公式转笛卡尔坐标，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;U&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;W&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1221" style="width: 28.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.572em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1022.57em, 2.929em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1222"><span class="mi" id="MathJax-Span-1223" style="font-family: STIXGeneral-Italic;">𝑈<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1224" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-1225" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">cos</span><span class="mo" id="MathJax-Span-1226"></span><span class="mo" id="MathJax-Span-1227" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1228"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1229" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1230" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1231" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1232" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="msubsup" id="MathJax-Span-1233" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1234" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1235" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1236" style="font-family: STIXGeneral-Italic;">𝑠</span><span class="mo" id="MathJax-Span-1237" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1238" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑉<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span class="mo" id="MathJax-Span-1239" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mi" id="MathJax-Span-1240" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">sin</span><span class="mo" id="MathJax-Span-1241"></span><span class="mo" id="MathJax-Span-1242" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1243"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1244" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1245" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1246" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1247" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="msubsup" id="MathJax-Span-1248" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1249" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1250" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1251" style="font-family: STIXGeneral-Italic;">𝑠</span><span class="mo" id="MathJax-Span-1252" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1253" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑊<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span class="mo" id="MathJax-Span-1254" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="msqrt" id="MathJax-Span-1255" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 4.368em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1003.38em, 4.318em, -999.998em); top: -4.015em; left: 0.945em;"><span class="mrow" id="MathJax-Span-1256"><span class="mn" id="MathJax-Span-1257" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1258" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1259" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1260" style="font-family: STIXGeneral-Italic;">𝑟</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.399em;"><span class="mn" id="MathJax-Span-1261" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1262"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.4em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1263" style="font-family: STIXGeneral-Italic;">𝑠</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="mn" id="MathJax-Span-1264" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1003.42em, 3.375em, -999.998em); top: -4.115em; left: 0.945em;"><span style="display: inline-block; position: relative; width: 3.425em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 2.929em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.796em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.243em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.639em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.086em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.483em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.879em, 1000.95em, 4.417em, -999.998em); top: -3.966em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>U</mi><mo>∗</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>r</mi><mn>2</mn></msub><mi>s</mi><mo>+</mo><mi>V</mi><mo>∗</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>r</mi><mn>2</mn></msub><mi>s</mi><mo>+</mo><mi>W</mi><mo>∗</mo><msqrt><mn>1</mn><mo>−</mo><msub><mi>r</mi><mn>2</mn></msub><msup><mi>s</mi><mn>2</mn></msup></msqrt></math></span></span><script type="math/tex" id="MathJax-Element-146">U\ast\cos(r_1)\ast r_2s+V\ast\sin(r_1)\ast r_2s+W\ast \sqrt{1-r_2s^2}</script> 计算出在半球面的随机矢量，再归一化得到反射矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1265" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1266"><span class="mi" id="MathJax-Span-1267" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-147">D</script>。</li>
</ol>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1BAN1dROD3KVjSZFFXXcn9pXa-196-218.png" alt=""></p>
<p>最后，递归地调用 <code>radiance()</code> 函数，将反射光线作为参数传入，传入已自增过一次的深度和随机种子。其结果乘以表面的颜色，再加上球体表面的发射光颜色，作为结果返回。这就是此光追算法对散射表面的处理。</p>
<pre><code class="language-c">if (obj.refl == DIFF){                  // Ideal DIFFUSE reflection
    double r1=2*M_PI*erand48(Xi), r2=erand48(Xi), r2s=sqrt(r2);
    Vec w=nl, u=((fabs(w.x)&gt;.1?Vec(0,1):Vec(1))%w).norm(), v=w%u;
    Vec d = (u*cos(r1)*r2s + v*sin(r1)*r2s + w*sqrt(1-r2)).norm();
    return obj.e + f.mult(radiance(Ray(x,d),depth,Xi));</code></pre>
<p>总结一下各变量的含义：</p>
<ul>
<li><code>u</code>，<code>v</code>，<code>w</code>：互相正交的三个归一化矢量，<code>w</code> 即为法向量。</li>
<li><code>r1</code>：反射光线在反射表面与 <code>u</code> 的交角。</li>
<li><code>r2</code> 与 <code>r2s</code>：<code>r2s</code> 为反射光线在反射表面投影的长度，<code>r2</code> 为此值的平方。</li>
<li><code>d</code>：随机求取的反射方向。</li>
</ul>
<h3 id="镜面反射">镜面反射</h3>
<p>镜面反射比较简单，因为对于确定的入射光线，反射的方向也是确定的，因此没有随机过程，直接取镜面反射的方向继续进行光追。</p>
<p>镜面反射的求法比较简单，不过也记录一下吧：如下图对称的两条射线 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1268" style="width: 1.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.24em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1269"><span class="msubsup" id="MathJax-Span-1270"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1271" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1272" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-148">D_1</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1273" style="width: 1.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.24em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1274"><span class="msubsup" id="MathJax-Span-1275"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1276" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1277" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-149">D_2</script>，而法线为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1278" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1279"><span class="mi" id="MathJax-Span-1280" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-150">N</script>（法线是归一化的）。此时有 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1281" style="width: 13.842em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.965em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1010.91em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1282"><span class="msubsup" id="MathJax-Span-1283"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1284" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1285" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1286" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-1287" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1288" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1289" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1290" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-1291" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1292" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mn" id="MathJax-Span-1293" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">2</span><span class="mo" id="MathJax-Span-1294" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1295" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1296" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="msubsup" id="MathJax-Span-1297" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1298" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1299" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1300" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mn>1</mn></msub><mo>+</mo><msub><mi>D</mi><mn>2</mn></msub><mo>=</mo><mi>N</mi><mo>∗</mo><mn>2</mn><mo stretchy="false">(</mo><mi>N</mi><mo>⋅</mo><msub><mi>D</mi><mn>1</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-151">D_1+D_2=N\ast 2(N\cdot D_1)</script>，求解 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1301" style="width: 13.842em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.965em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1010.97em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1302"><span class="msubsup" id="MathJax-Span-1303"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1304" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1305" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1306" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-1307" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1308" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mn" id="MathJax-Span-1309" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">2</span><span class="mo" id="MathJax-Span-1310" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1311" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1312" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="msubsup" id="MathJax-Span-1313" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1314" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1315" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1316" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1317" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1318" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1319" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1320" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mn>2</mn></msub><mo>=</mo><mi>N</mi><mo>∗</mo><mn>2</mn><mo stretchy="false">(</mo><mi>N</mi><mo>⋅</mo><msub><mi>D</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>−</mo><msub><mi>D</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-152">D_2=N\ast 2(N\cdot D_1)-D_1</script> 。在代码中，<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1321" style="width: 1.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.24em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1322"><span class="msubsup" id="MathJax-Span-1323"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1324" style="font-family: STIXGeneral-Italic;">𝐷</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mn" id="MathJax-Span-1325" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>D</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-153">D_1</script> 就是 <code>-r.d</code>，带入得到 <code>r.d-n*2*n.dot(r.d)</code>，即反射光线的。由于 <code>r.d</code> 也已经是归一化的了，所以求取得到的结果也一定是归一化的。</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1ich6dUGF3KVjSZFoXXbmpFXa-376-183.png" alt=""></p>
<p>代码如下：</p>
<pre><code class="language-c">} else if (obj.refl == SPEC)            // Ideal SPECULAR reflection
    return obj.e + f.mult(radiance(Ray(x,r.d-n*2*n.dot(r.d)),depth,Xi));</code></pre>
<h3 id="折射">折射</h3>
<p>折射是比较复杂的。不同的物体有不同的折射率，空气的折射率为 1，玻璃的折射率为 1.5。根据折射定理：光线从折射率为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1326" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.95em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1327"><span class="msubsup" id="MathJax-Span-1328"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1329" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1330" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>n</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-154">n_1</script> 的介质折射到折射率为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1331" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.95em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1332"><span class="msubsup" id="MathJax-Span-1333"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1334" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1335" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>n</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-155">n_2</script> 的介质，折射角满足（此定理可以从更一般的麦克斯韦电磁方程组推导出来，厉害厉害）：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1336" style="width: 10.221em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 8.088em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1008.09em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1337"><span class="msubsup" id="MathJax-Span-1338"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1339" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1340" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1341" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">sin</span><span class="mo" id="MathJax-Span-1342"></span><span class="msubsup" id="MathJax-Span-1343" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1344" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1345" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1346" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-1347" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1348" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1349" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1350" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">sin</span><span class="mo" id="MathJax-Span-1351"></span><span class="msubsup" id="MathJax-Span-1352" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1353" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1354" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>n</mi><mn>1</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-156">\begin{equation}n_1\sin \theta_1 = n_2 \sin \theta_2\end{equation}</script></p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1dI9VawFY.1VjSZFnXXcFHXXa-511-230.png" alt=""></p>
<h4 id="全反射">全反射</h4>
<p>首先需要考虑的是全反射现象，即光线从光密介质（玻璃）向光疏介质（空气）传播时（上图右半部分），<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1355" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1356"><span class="msubsup" id="MathJax-Span-1357"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1358" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1359" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-157">\theta_1</script> 大于临界角（使得 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1360" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1361"><span class="msubsup" id="MathJax-Span-1362"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1363" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1364" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-158">\theta_2</script> 为 90° 的 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1365" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1366"><span class="msubsup" id="MathJax-Span-1367"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1368" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1369" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-159">\theta_1</script>），以至于不存在 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1370" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1371"><span class="msubsup" id="MathJax-Span-1372"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1373" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1374" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-160">\theta_2</script> 满足上述折射定理时，所有光都被反射的现象，即：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;90&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xB0;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1375" style="width: 10.122em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 8.038em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.193em, 1007.99em, 3.475em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1376"><span class="mi" id="MathJax-Span-1377" style="font-family: STIXGeneral-Regular;">sin</span><span class="mo" id="MathJax-Span-1378"></span><span class="msubsup" id="MathJax-Span-1379" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1380" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1381" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1382" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&gt;</span><span class="mfrac" id="MathJax-Span-1383" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1384"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1385" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1386" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1387"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1388" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1389" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001.04em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mi" id="MathJax-Span-1390" style="font-family: STIXGeneral-Regular;">sin</span><span class="mo" id="MathJax-Span-1391"></span><span class="mo" id="MathJax-Span-1392" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-1393" style="font-family: STIXGeneral-Regular;">90</span><span class="texatom" id="MathJax-Span-1394"><span class="mrow" id="MathJax-Span-1395"><span class="mo" id="MathJax-Span-1396" style="font-family: STIXGeneral-Regular;">°</span></span></span><span class="mo" id="MathJax-Span-1397" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>&gt;</mo><mfrac><msub><mi>n</mi><mn>2</mn></msub><msub><mi>n</mi><mn>1</mn></msub></mfrac><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mn>90</mn><mrow class="MJX-TeXAtom-ORD"><mo>°</mo></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-161">\begin{equation}\sin \theta_1 > \frac{n_2}{n_1} \sin(90°)\end{equation}</script></p>
<p>两边平方并作简单变换，得到：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1398" style="width: 12.453em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 9.874em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.193em, 1009.87em, 3.475em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1399"><span class="mo" id="MathJax-Span-1400" style="font-family: STIXGeneral-Regular;">(</span><span class="mfrac" id="MathJax-Span-1401"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1402"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1403" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1404" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1405"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1406" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1407" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001.04em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1408"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1409" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-1410" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1411" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1412" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.788em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1413" style="font-family: STIXGeneral-Regular;">cos</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.342em;"><span class="mn" id="MathJax-Span-1414" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1415"></span><span class="msubsup" id="MathJax-Span-1416" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1417" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1418" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1419" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-1420" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span><span class="mo" id="MathJax-Span-1421" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&lt;</span><span class="mn" id="MathJax-Span-1422" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mfrac><msub><mi>n</mi><mn>2</mn></msub><msub><mi>n</mi><mn>1</mn></msub></mfrac><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo>&lt;</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-162">\begin{equation}(\frac{n_2}{n_1})^2-\cos^2 \theta_1+1<0\end{equation}</script></p>
<p>由于 <code>nnt</code> 为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1423" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.193em, 1001em, 2.78em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1424"><span class="mfrac" id="MathJax-Span-1425"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.574em, 1000.65em, 4.268em, -999.998em); top: -4.511em; left: 50%; margin-left: -0.345em;"><span class="msubsup" id="MathJax-Span-1426"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1427" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mn" id="MathJax-Span-1428" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.65em, 4.268em, -999.998em); top: -3.668em; left: 50%; margin-left: -0.345em;"><span class="msubsup" id="MathJax-Span-1429"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1430" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mn" id="MathJax-Span-1431" style="font-size: 50%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1000.8em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.796em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.622em; border-left: 0px solid; width: 0px; height: 1.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><msub><mi>n</mi><mn>1</mn></msub><msub><mi>n</mi><mn>2</mn></msub></mfrac></math></span></span><script type="math/tex" id="MathJax-Element-163">\frac{n_1}{n_2}</script>，而 <code>ddn</code> 为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1432" style="width: 4.219em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.326em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1003.33em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1433"><span class="mo" id="MathJax-Span-1434" style="font-family: STIXGeneral-Regular;">−</span><span class="mi" id="MathJax-Span-1435" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">cos</span><span class="mo" id="MathJax-Span-1436"></span><span class="msubsup" id="MathJax-Span-1437" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1438" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1439" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-164">-\cos \theta_1</script>，代入上式，得到全反射的条件即是 <code>1-nnt*nnt*(1-ddn*ddn))&lt;0</code>。满足全反射条件时，镜面反射的方式进行处理。</p>
<pre><code class="language-c">Ray reflRay(x, r.d-n*2*n.dot(r.d));     // Ideal dielectric REFRACTION
bool into = n.dot(nl)&gt;0;                // Ray from outside going in?
double nc=1, nt=1.5, nnt=into?nc/nt:nt/nc, ddn=r.d.dot(nl), cos2t;
if ((cos2t=1-nnt*nnt*(1-ddn*ddn))&lt;0)    // Total internal reflection
    return obj.e + f.mult(radiance(reflRay,depth,Xi));</code></pre>
<p>总结一下各变量的含义：</p>
<ul>
<li><code>reflRay</code>：镜面反射方向，与上一节中的求法完全一致。</li>
<li><code>into</code>：由空气（试图）进入玻璃则为 <code>true</code>，由玻璃（试图）进入空气则为 <code>false</code>。</li>
<li><code>nc</code> 和 <code>nt</code>：空气和玻璃的折射率。</li>
<li><code>nnt</code> 为折射率比值，当追踪的射线是从空气进入玻璃时，<code>nnt</code> 为 <code>1.0/1.5</code>，当射线是从玻璃进入空气时，<code>nnt</code> 为 <code>1.5</code>。</li>
<li><code>ddn</code>：即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1440" style="width: 4.219em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.326em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1003.33em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1441"><span class="mo" id="MathJax-Span-1442" style="font-family: STIXGeneral-Regular;">−</span><span class="mi" id="MathJax-Span-1443" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">cos</span><span class="mo" id="MathJax-Span-1444"></span><span class="msubsup" id="MathJax-Span-1445" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1446" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1447" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-165">-\cos \theta_1</script> 的值，由 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1448" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1449"><span class="mi" id="MathJax-Span-1450" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-166">D</script> 和 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1451" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.89em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1452"><span class="mi" id="MathJax-Span-1453" style="font-family: STIXGeneral-Italic;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-167">N</script> 点乘而来。</li>
</ul>
<h4 id="正常折射">正常折射</h4>
<p>所谓正常折射，即是光线一部分镜面反射，一部分折射进入另一种介质。此时，我们需要：</p>
<ol>
<li>计算折射光线矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1454" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.65em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1455"><span class="mi" id="MathJax-Span-1456" style="font-family: STIXGeneral-Italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math></span></span><script type="math/tex" id="MathJax-Element-168">T</script>。</li>
<li>计算有多少比例的光线被反射，有多少比例的光线被折射。</li>
<li>根据条件，选择以随机或非随机的形式，递归地进行光线追踪。</li>
</ol>
<p>首先计算折射光线矢量 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1457" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.65em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1458"><span class="mi" id="MathJax-Span-1459" style="font-family: STIXGeneral-Italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math></span></span><script type="math/tex" id="MathJax-Element-169">T</script>：</p>
<p><img src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/TB1SZCecAxz61VjSZFrXXXeLFXa-209-227.png" alt=""></p>
<p>首先，假设入射光线在表面平面的投影矢量（并归一化）为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1460" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1461"><span class="mi" id="MathJax-Span-1462" style="font-family: STIXGeneral-Italic;">𝐵</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math></span></span><script type="math/tex" id="MathJax-Element-170">B</script> 已知，折射角 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1463" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1464"><span class="msubsup" id="MathJax-Span-1465"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1466" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1467" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-171">\theta_2</script> 也已知，我们可以得到 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1468" style="width: 0.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.65em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1469"><span class="mi" id="MathJax-Span-1470" style="font-family: STIXGeneral-Italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi></math></span></span><script type="math/tex" id="MathJax-Element-172">T</script> 为：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1471" style="width: 12.403em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 9.824em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1009.82em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1472"><span class="mi" id="MathJax-Span-1473" style="font-family: STIXGeneral-Italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-1474" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-1475" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">𝐵</span><span class="mi" id="MathJax-Span-1476" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">sin</span><span class="mo" id="MathJax-Span-1477"></span><span class="msubsup" id="MathJax-Span-1478" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1479" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1480" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1481" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1482" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mi" id="MathJax-Span-1483" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">cos</span><span class="mo" id="MathJax-Span-1484"></span><span class="msubsup" id="MathJax-Span-1485" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1486" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1487" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mo>=</mo><mi>B</mi><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub><mo>−</mo><mi>N</mi><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-173">\begin{equation}T=B\sin \theta_2 - N\cos \theta_2\end{equation}</script></p>
<p>其中 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1488" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.7em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1489"><span class="mi" id="MathJax-Span-1490" style="font-family: STIXGeneral-Italic;">𝐵</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi></math></span></span><script type="math/tex" id="MathJax-Element-174">B</script> 就是入射光线平面上的投影矢量（因为入射和折射在同一个平面内）归一化得到，而此投影矢量可以使用 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1491" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1492"><span class="mi" id="MathJax-Span-1493" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-175">D</script> 减去 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1494" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.75em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1495"><span class="mi" id="MathJax-Span-1496" style="font-family: STIXGeneral-Italic;">𝐷</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-176">D</script> 在法线上的投影 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1497" style="width: 3.127em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.483em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1002.48em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1498"><span class="mi" id="MathJax-Span-1499" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1500" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1501" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi><mo>⋅</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-177">D\cdot N</script>（注意这里点积是个负数）来得出，因此：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1502" style="width: 11.758em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 9.328em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.995em, 1009.33em, 3.822em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1503"><span class="mi" id="MathJax-Span-1504" style="font-family: STIXGeneral-Italic;">𝐵</span><span class="mo" id="MathJax-Span-1505" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1506" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 7.145em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.177em, 1007em, 4.368em, -999.998em); top: -4.71em; left: 50%; margin-left: -3.519em;"><span class="mrow" id="MathJax-Span-1507"><span class="mi" id="MathJax-Span-1508" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1509" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1510" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1511" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mo" id="MathJax-Span-1512" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-1513" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1514" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1515" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1516" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1006.2em, 4.467em, -999.998em); top: -3.123em; left: 50%; margin-left: -3.123em;"><span class="msqrt" id="MathJax-Span-1517"><span style="display: inline-block; position: relative; width: 6.203em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1005.26em, 4.368em, -999.998em); top: -4.015em; left: 0.945em;"><span class="mrow" id="MathJax-Span-1518"><span class="mn" id="MathJax-Span-1519" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1520" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mo" id="MathJax-Span-1521" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-1522" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1523" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1524" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="msubsup" id="MathJax-Span-1525"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1526" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.35em;"><span class="mn" id="MathJax-Span-1527" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1005.26em, 3.375em, -999.998em); top: -4.115em; left: 0.945em;"><span style="display: inline-block; position: relative; width: 5.26em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 4.764em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.185em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.582em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.028em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.475em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.921em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.368em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.879em, 1000.95em, 4.417em, -999.998em); top: -3.966em; left: 0em;"><span style="font-family: STIXGeneral-Regular;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1007.14em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.145em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.316em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mo>=</mo><mfrac><mrow><mi>D</mi><mo>−</mo><mi>N</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><msqrt><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></msqrt></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-178">\begin{equation}B=\frac{D-N\ast (D\cdot N)}{\sqrt{1-(D\cdot N)^2}}\end{equation}</script></p>
<p>同时 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1528" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1529"><span class="msubsup" id="MathJax-Span-1530"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1531" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1532" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-179">\theta_2</script> 的正弦和余弦值也可以通过折射定律求得：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1533" style="width: 20.092em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 15.925em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.094em, 1015.92em, 3.475em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1534"><span class="mi" id="MathJax-Span-1535" style="font-family: STIXGeneral-Regular;">sin</span><span class="mo" id="MathJax-Span-1536"></span><span class="msubsup" id="MathJax-Span-1537" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1538" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1539" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1540" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1541" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1542"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1543" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1544" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1545"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1546" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1547" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001.04em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mi" id="MathJax-Span-1548" style="font-family: STIXGeneral-Regular;">sin</span><span class="mo" id="MathJax-Span-1549"></span><span class="msubsup" id="MathJax-Span-1550" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1551" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1552" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1553" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1554" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1555"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1556" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1557" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1558"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1559" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1560" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001.04em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="msqrt" id="MathJax-Span-1561"><span style="display: inline-block; position: relative; width: 6.352em; height: 0px;"><span style="position: absolute; clip: rect(2.979em, 1005.26em, 4.368em, -999.998em); top: -4.015em; left: 1.044em;"><span class="mrow" id="MathJax-Span-1562"><span class="mn" id="MathJax-Span-1563" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1564" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mo" id="MathJax-Span-1565" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-1566" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1567" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1568" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="msubsup" id="MathJax-Span-1569"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1570" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-1571" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1005.26em, 3.375em, -999.998em); top: -4.412em; left: 1.044em;"><span style="display: inline-block; position: relative; width: 5.26em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 4.764em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.185em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.582em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.028em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.475em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.921em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.368em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.334em, 1001.09em, 4.467em, -999.998em); top: -3.718em; left: 0em;"><span style="font-family: STIXSizeOneSym;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub><mo>=</mo><mfrac><msub><mi>n</mi><mn>1</mn></msub><msub><mi>n</mi><mn>2</mn></msub></mfrac><mi>sin</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>=</mo><mfrac><msub><mi>n</mi><mn>1</mn></msub><msub><mi>n</mi><mn>2</mn></msub></mfrac><msqrt><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-180">\begin{equation}\sin \theta_2 = \frac{n_1}{n_2} \sin \theta_1 = \frac{n_1}{n_2}  \sqrt{  1-(D\cdot N)^2}\end{equation}</script></p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;msubsup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;msubsup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1572" style="width: 25.747em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 20.439em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1020.44em, 3.921em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1573"><span class="mi" id="MathJax-Span-1574" style="font-family: STIXGeneral-Regular;">cos</span><span class="mo" id="MathJax-Span-1575"></span><span class="msubsup" id="MathJax-Span-1576" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1577" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1578" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1579" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msqrt" id="MathJax-Span-1580" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 5.459em; height: 0px;"><span style="position: absolute; clip: rect(2.979em, 1004.42em, 4.318em, -999.998em); top: -4.015em; left: 1.044em;"><span class="mrow" id="MathJax-Span-1581"><span class="mn" id="MathJax-Span-1582" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1583" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1584" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.14em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1585" style="font-family: STIXGeneral-Regular;">sin</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.193em;"><span class="mn" id="MathJax-Span-1586" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1587"></span><span class="msubsup" id="MathJax-Span-1588" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1589" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1590" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1004.42em, 3.375em, -999.998em); top: -4.462em; left: 1.044em;"><span style="display: inline-block; position: relative; width: 4.417em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 3.921em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.185em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.631em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.028em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.475em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.334em, 1001.09em, 4.467em, -999.998em); top: -3.718em; left: 0em;"><span style="font-family: STIXSizeOneSym;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1591" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msqrt" id="MathJax-Span-1592" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 9.973em; height: 0px;"><span style="position: absolute; clip: rect(2.284em, 1008.83em, 5.26em, -999.998em); top: -4.015em; left: 1.094em;"><span class="mrow" id="MathJax-Span-1593"><span class="mn" id="MathJax-Span-1594" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1595" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-1596" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.028em, 1000.95em, 4.467em, -999.998em); top: -4.809em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1597"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1598" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mn" id="MathJax-Span-1599" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mn" id="MathJax-Span-1600" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1000.95em, 4.467em, -999.998em); top: -3.222em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1601"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1602" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mn" id="MathJax-Span-1603" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mn" id="MathJax-Span-1604" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001.04em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.044em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-1605" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-1606" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1607" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mo" id="MathJax-Span-1608" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-1609" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1610" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1611" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="msubsup" id="MathJax-Span-1612"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1613" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-1614" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1615" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1008.93em, 3.375em, -999.998em); top: -4.908em; left: 1.094em;"><span style="display: inline-block; position: relative; width: 8.931em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 8.435em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.185em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.631em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.078em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.524em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.971em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.417em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.864em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 5.31em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 5.756em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 6.203em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 6.649em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.096em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.542em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.989em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(1.342em, 1001.09em, 4.715em, -999.998em); top: -3.271em; left: 0em;"><span style="font-family: STIXSizeThreeSym;">√</span><span style="display: inline-block; width: 0px; height: 4.07em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.684em; border-left: 0px solid; width: 0px; height: 4.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub><mo>=</mo><msqrt><mn>1</mn><mo>−</mo><msup><mi>sin</mi><mn>2</mn></msup><mo>⁡</mo><msub><mi>θ</mi><mn>2</mn></msub></msqrt><mo>=</mo><msqrt><mn>1</mn><mo>−</mo><mfrac><msubsup><mi>n</mi><mn>1</mn><mn>2</mn></msubsup><msubsup><mi>n</mi><mn>2</mn><mn>2</mn></msubsup></mfrac><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-181">\begin{equation}\cos \theta_2 = \sqrt{1-\sin^2\theta_2} = \sqrt{1-\frac{n_1^2}{n_2^2}(1-(D\cdot N)^2)}\end{equation}</script></p>
<p>全部代入，可得：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msubsup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mfrac&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1616" style="width: 27.631em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 21.927em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1021.93em, 3.921em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1617"><span class="mi" id="MathJax-Span-1618" style="font-family: STIXGeneral-Italic;">𝑇<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-1619" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1620" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 7.741em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.177em, 1007.54em, 4.368em, -999.998em); top: -4.71em; left: 50%; margin-left: -3.817em;"><span class="mrow" id="MathJax-Span-1621"><span class="msubsup" id="MathJax-Span-1622"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1623" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1624" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1625" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1626" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1627" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mi" id="MathJax-Span-1628" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1629" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1630" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1631" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1632" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1633" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1634" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.95em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1635"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1636" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1637" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1007.74em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.741em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-1638" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1639" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="msqrt" id="MathJax-Span-1640"><span style="display: inline-block; position: relative; width: 9.973em; height: 0px;"><span style="position: absolute; clip: rect(2.284em, 1008.88em, 5.26em, -999.998em); top: -4.015em; left: 1.094em;"><span class="mrow" id="MathJax-Span-1641"><span class="mn" id="MathJax-Span-1642" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1643" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-1644" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 6.947em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.028em, 1006.8em, 4.467em, -999.998em); top: -4.809em; left: 50%; margin-left: -3.42em;"><span class="mrow" id="MathJax-Span-1645"><span class="msubsup" id="MathJax-Span-1646"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1647" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mn" id="MathJax-Span-1648" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mn" id="MathJax-Span-1649" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1650" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-1651" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1652" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mo" id="MathJax-Span-1653" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-1654" style="font-family: STIXGeneral-Italic;">𝐷</span><span class="mo" id="MathJax-Span-1655" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">⋅</span><span class="mi" id="MathJax-Span-1656" style="font-family: STIXGeneral-Italic; padding-left: 0.25em;">𝑁<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="msubsup" id="MathJax-Span-1657"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1658" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.35em;"><span class="mn" id="MathJax-Span-1659" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1660" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1000.95em, 4.467em, -999.998em); top: -3.222em; left: 50%; margin-left: -0.444em;"><span class="msubsup" id="MathJax-Span-1661"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1662" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mn" id="MathJax-Span-1663" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.45em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mn" id="MathJax-Span-1664" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1006.95em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.947em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.028em, 1008.93em, 3.375em, -999.998em); top: -4.908em; left: 1.094em;"><span style="display: inline-block; position: relative; width: 8.931em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: STIXGeneral-Regular; top: -4.015em; left: 8.435em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.399em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 0.846em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.292em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 1.739em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.185em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 2.631em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.078em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.524em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 3.971em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.417em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 4.864em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 5.31em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 5.756em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 6.203em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 6.649em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.096em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.542em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: STIXGeneral-Regular; position: absolute; top: -4.015em; left: 7.989em;">‾<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(1.342em, 1001.09em, 4.715em, -999.998em); top: -3.271em; left: 0em;"><span style="font-family: STIXSizeThreeSym;">√</span><span style="display: inline-block; width: 0px; height: 4.07em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.684em; border-left: 0px solid; width: 0px; height: 4.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>T</mi><mo>=</mo><mfrac><mrow><msub><mi>n</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>D</mi><mo>+</mo><mi>N</mi><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><msub><mi>n</mi><mn>2</mn></msub></mfrac><mo>−</mo><mi>N</mi><msqrt><mn>1</mn><mo>−</mo><mfrac><mrow><msubsup><mi>n</mi><mn>1</mn><mn>2</mn></msubsup><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mi>D</mi><mo>⋅</mo><mi>N</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><msubsup><mi>n</mi><mn>2</mn><mn>2</mn></msubsup></mfrac></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-182">\begin{equation}T=\frac{n_1(D+N(D\cdot N))}{n_2}-N \sqrt{1-\frac{n_1^2(1-(D\cdot N)^2)}{n_2^2}}\end{equation}</script></p>
<p>按照上述公式，将变量代入，即可计算出折射光线归一化矢量 <code>tdir</code>：</p>
<pre><code class="language-c">Vec tdir = (r.d*nnt - n*((into?1:-1)*(ddn*nnt+sqrt(cos2t)))).norm();</code></pre>
<p>接下来，计算有多少比例的光线被反射，有多少比例的光线被折射。根据电动力学的一些理论，入射光线（普通的非偏振光）被反射/折射的比例，与入射角 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1665" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1000.89em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1666"><span class="msubsup" id="MathJax-Span-1667"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1668" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1669" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-183">\theta_1</script>，两种介质的折射率都有关系。当入射角等于 0（即垂直入射到表面）时，被反射的比例 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1670" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1671"><span class="msubsup" id="MathJax-Span-1672"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1673" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-1674" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-184">R_0</script> 为：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1675" style="width: 8.782em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 6.947em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.094em, 1006.95em, 3.475em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1676"><span class="msubsup" id="MathJax-Span-1677"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1678" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-1679" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1680" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-1681" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">(</span><span class="mfrac" id="MathJax-Span-1682"><span style="display: inline-block; position: relative; width: 3.177em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.326em, 1003.03em, 4.318em, -999.998em); top: -4.71em; left: 50%; margin-left: -1.535em;"><span class="mrow" id="MathJax-Span-1683"><span class="msubsup" id="MathJax-Span-1684"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1685" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1686" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1687" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1688" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1689" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1690" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1003.03em, 4.318em, -999.998em); top: -3.321em; left: 50%; margin-left: -1.535em;"><span class="mrow" id="MathJax-Span-1691"><span class="msubsup" id="MathJax-Span-1692"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1693" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1694" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1695" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-1696" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1697" style="font-family: STIXGeneral-Italic;">𝑛</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1698" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1003.18em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.177em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1699"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1700" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-1701" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.122em; border-left: 0px solid; width: 0px; height: 2.753em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>R</mi><mn>0</mn></msub><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>−</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub></mrow></mfrac><msup><mo stretchy="false">)</mo><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-185">\begin{equation}R_0=(\frac{n_1-n_2}{n_1+n_2})^2\end{equation}</script></p>
<p>而当入射角为 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1702" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1000.5em, 2.631em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1703"><span class="mi" id="MathJax-Span-1704" style="font-family: STIXGeneral-Italic;">𝜃</span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-186">\theta</script> 时的反射比例 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1705" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.14em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1706"><span class="msubsup" id="MathJax-Span-1707"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1708" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mi" id="MathJax-Span-1709" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mi>θ</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-187">R_\theta</script> 为：</p>
<p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: left;"><span class="MathJax" id="MathJax-Element-188-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;5&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: left; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1710" style="width: 17.066em; display: inline-block; margin-left: 2.253em;"><span style="display: inline-block; position: relative; width: 13.544em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1013.54em, 2.83em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1711"><span class="msubsup" id="MathJax-Span-1712"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1713" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mi" id="MathJax-Span-1714" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1715" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-1716" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1717" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-1718" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1719" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mo" id="MathJax-Span-1720" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mn" id="MathJax-Span-1721" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1722" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-1723" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1724" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-1725" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1726" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1727" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-1728" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1729" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1730" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">cos</span><span class="mo" id="MathJax-Span-1731"></span><span class="msubsup" id="MathJax-Span-1732" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1733" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1734" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1735"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.3em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1736" style="font-family: STIXGeneral-Regular;">)</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.35em;"><span class="mn" id="MathJax-Span-1737" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">5</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>R</mi><mi>θ</mi></msub><mo>=</mo><msub><mi>R</mi><mn>0</mn></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>R</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub><msup><mo stretchy="false">)</mo><mn>5</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-188">\begin{equation}R_\theta=R_0+(1-R_0)(1-\cos \theta_1)^5\end{equation}</script></p>
<p>最后，基于当前光追的深度：</p>
<ol>
<li>如果深度小于等于 2，那么分别递归地追踪反射光和折射光，将两者对颜色的贡献再加上物体本身的发光，作为结果返回。</li>
<li>如果深度大于 2，那么依据折射和反射光线的占比来进行概率随机，选择追踪反射光或折射光中的一支。换言之，如果反射光占比高，那么就有较大的可能性随机到反射光线，反之亦然。注意，这时由于我们放弃了另一种可能性，会导致结果的期望产生偏差，所以需要进行一次修正。</li>
</ol>
<p>对玻璃材质，前几次反射、折射对最终的结果的贡献比较大，所以选择都进行追踪。但是这样做一下子使得某些追踪的采样次数发散为了原来的 4 倍，如果深度改为 4，可能就是 16 倍。所以代码把发散深度限制在 2 这样一个比较小的数值，也算是在效果和性能间达到一个平衡。</p>
<p>代码如下：</p>
<pre><code class="language-c">double a=nt-nc, b=nt+nc, R0=a*a/(b*b), c = 1-(into?-ddn:tdir.dot(n));
double Re=R0+(1-R0)*c*c*c*c*c,Tr=1-Re,P=.25+.5*Re,RP=Re/P,TP=Tr/(1-P);
return obj.e + f.mult(depth&gt;2 ? (erand48(Xi)&lt;P ?   // Russian roulette
    radiance(reflRay,depth,Xi)*RP : radiance(Ray(x,tdir),depth,Xi)*TP) :
    radiance(reflRay,depth,Xi)*Re+radiance(Ray(x,tdir),depth,Xi)*Tr);</code></pre>
<p>最后解释一下各个变量的含义：</p>
<ul>
<li><code>a</code> 和 <code>b</code>：用以计算 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-189-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1738" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1001.19em, 2.483em, -999.998em); top: -2.18em; left: 0em;"><span class="mrow" id="MathJax-Span-1739"><span class="msubsup" id="MathJax-Span-1740"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1741" style="font-family: STIXGeneral-Italic;">𝑅</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="mn" id="MathJax-Span-1742" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.185em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>R</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-189">R_0</script> 的临时变量。</li>
<li><code>R0</code>：入射角为 0 时反射光的占比。</li>
<li><code>c</code>：即 <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-190-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1743" style="width: 5.211em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.12em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1004.12em, 2.78em, -999.998em); top: -2.478em; left: 0em;"><span class="mrow" id="MathJax-Span-1744"><span class="mn" id="MathJax-Span-1745" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-1746" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mi" id="MathJax-Span-1747" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">cos</span><span class="mo" id="MathJax-Span-1748"></span><span class="msubsup" id="MathJax-Span-1749" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.227em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1750" style="font-family: STIXGeneral-Italic;">𝜃</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mn" id="MathJax-Span-1751" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mi>cos</mi><mo>⁡</mo><msub><mi>θ</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-190">1-\cos \theta_1</script>。</li>
<li><code>Re</code>：当前入射角下反射光的占比。</li>
<li><code>Tr</code>：折射光的占比。</li>
<li><code>RP</code>：随机到反射光时，对结果的修正的因子。</li>
<li><code>TP</code>：随机到折射光时，对结果的修正的因子。</li>
</ul>
<p>这样，光追算法就全部完成了。</p>
<h2 id="感想">感想</h2>
<p>一直觉得光线追踪是非常高端的存在，因为没有基础，想了解也不知从何看起。一个偶然的机会发现到这个 demo，觉得挺有意思，就拿过来研究了。结果发现看起来还是比较吃力，好在另外一个老外的解读 PPT 帮了很大的忙。</p>
<p>把学习过的东西消化了，再重新写出来是件很折磨的事情，但收获也不小。每一个公式一步一步推导过来，对一些地方「为什么这么做」也有了不一样的体会。数学还是挺重要的，而且能够给人带来很强的成就感。</p>
</div>
        </div>
      </div>
    </div>
    <link rel="stylesheet" href="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/tomorrow.min.css">
    <script type="text/javascript" src="./一叶斋 _ SmallPT —— 99 行代码光线追踪解析_files/MathJax.js"></script>
    <script>
      MathJax.Hub.Config({
          jax: ["input/TeX","output/HTML-CSS"],
          displayIndent: "2em",
          tex2jax: {
              inlineMath: [['$','$'], ['\\(','\\)']],
              processEscapes: true
          },
          "HTML-CSS": {
              linebreaks: {
                  automatic: true
              },
              scale: 100
          },
          SVG: {
              linebreaks: {
                  automatic: true
              }
          },
          displayAlign: "left"
      });
    </script>
  
<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: STIXSizeOneSym, sans-serif;"></div></div></body></html>